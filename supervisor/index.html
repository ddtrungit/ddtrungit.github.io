<!DOCTYPE html><html lang="vi"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Supervisor - TRUNG DUONG</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><meta name="theme-color" content="#17181E" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#D73A42" media="(prefers-color-scheme: light)"><meta name="msapplication-navbutton-color" content="#D73A42"><meta name="apple-mobile-web-app-status-bar-style" content="#D73A42"><link rel="alternate" type="application/atom+xml" href="https://ddtrungit.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://ddtrungit.github.io/feed.json"><link rel="shortcut icon" href="https://ddtrungit.github.io/media/website/cropped-2019-09-16-32x32.png" type="image/x-icon"><link rel="shortcut icon" href="https://ddtrungit.github.io/media/website/cropped-2019-09-16-32x32.png" type="image/x-icon"><link rel="stylesheet" href="https://ddtrungit.github.io/assets/css/style.css?v=4becd99c93342dd7c117b97188f052e6"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ddtrungit.github.io/supervisor/index.html"},"headline":"Supervisor","datePublished":"2021-05-17T07:53","dateModified":"2022-06-13T14:26","image":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/posts/99/597.png","height":359,"width":863},"description":"Supervisor là một công cụ giúp quản lý các process chạy trên Linux. Một số trường hợp dùng Supervisor như: Ví&hellip;","author":{"@type":"Person","name":"Duong Dinh Trung","url":"https://ddtrungit.github.io/authors/dtrungit/"},"publisher":{"@type":"Organization","name":"Duong Dinh Trung","logo":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/website/Background_2.png","height":800,"width":834}}}</script></head><body><header class="header" id="js-header"><a href="https://ddtrungit.github.io/index.html" class="logo"><img src="https://ddtrungit.github.io/media/website/Background_2.png" alt="TRUNG DUONG"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://ddtrungit.github.io/index.html" target="_self">Home</a></li><li><a href="https://ddtrungit.github.io/lien-he/index.html" target="_self">Contact</a></li><li><a href="https://ddtrungit.github.io/gioi-thieu/index.html" target="_self">About</a></li><li><a href="https://ddtrungit.github.io/tags/ansible/index.html" target="_self">Ansible</a></li><li><a href="https://ddtrungit.github.io/tags/aws/index.html" target="_self">AWS</a></li><li><a href="https://ddtrungit.github.io/tags/oracle/index.html" target="_self">Oracle</a></li><li><a href="https://ddtrungit.github.io/tags/linux/index.html" target="_self">Linux</a></li><li><a href="https://ddtrungit.github.io/tags/zimbra/index.html" target="_self">Zimbra</a></li><li><a href="https://ddtrungit.github.io/tags/tip/index.html" target="_self">TIP</a></li><li><a href="https://ddtrungit.github.io/tags/k8s/index.html" target="_self">Kubernetes</a></li></ul></nav></header><main><div class="wrapper"><article class="post"><header class="post__header"><h1 class="post__title">Supervisor</h1><div class="post__meta"><div class="post__author">By <a href="https://ddtrungit.github.io/authors/dtrungit/index.html" class="invert" rel="author" title="Duong Dinh Trung">Duong Dinh Trung</a></div><div class="post__comments"><a href="https://ddtrungit.github.io/supervisor/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://ddtrungit.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></div></header><figure class="post__featured-image"><img src="https://ddtrungit.github.io/media/posts/99/597.png" srcset="https://ddtrungit.github.io/media/posts/99/responsive/597-xs.png 300w, https://ddtrungit.github.io/media/posts/99/responsive/597-sm.png 480w, https://ddtrungit.github.io/media/posts/99/responsive/597-md.png 768w, https://ddtrungit.github.io/media/posts/99/responsive/597-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="eager" height="359" width="863" alt=""></figure><div class="post__inner"><div class="post__entry"><p style="margin: 0in; font-family: Merriweather; font-size: 14.5pt; color: #443f3f;"><span style="font-weight: bold; background: white;">Supervisor là một công cụ giúp quản lý các process chạy trên Linux.</span><span style="background: white;"> Một số trường hợp dùng Supervisor như:</span></p><ul style="margin-left: .375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in;" type="disc"><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">Run something as a permanent process. Đảm bảo một process nào đó luôn luôn chạy, chạy hoài, chạy mãi. Nếu vì lý do gì mà nó bị tắt, thì Supervisor sẽ khởi động process đó lại</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">Tự động chạy một process khi khởi động hệ thống</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">Quản lý nhiều process dưới dạng một group các process, có thể được bật/tắt cùng lúc</span></li></ul><p style="margin: 0in; font-family: Merriweather; font-size: 14.5pt; color: #443f3f;"><span style="background: white;">Ví dụ điển hình là trường hợp Laravel dùng Supervisor để giữ cho tiến trình sử lý queue chạy liên tục ko ngừng nghỉ. Trong trường hợp tiến trình mà supervisor thực thi phát sinh lỗi, ta có thể cấu hình để Supervisor retry lại một số lần nhất định trước khi chính thức báo fail. Tính năng này khá hữu dụng trong một số trường hợp mà việc thực thi là ko chắc chắn, ko dự đoán trước được.</span></p><p style="margin: 0in; font-family: 'Merriweather Sans'; font-size: 10.0pt; color: #1e1e1e;"><span style="font-weight: bold; background: white;">Cài đặt Supervisor trên CentOS 7</span></p><p style="margin: 0in; font-family: Merriweather; font-size: 14.5pt; color: #443f3f;"><span style="background: white;">Nếu đã cài repo EPEL thì mọi chuyện easy, chỉ việc gõ</span></p><p style="margin: 0in; font-family: Calibri; font-size: 10.0pt; color: #443f3f;"><span style="background: #F1F1F1;">yum install supervisor -y</span></p><p style="margin: 0in; font-family: Merriweather; font-size: 14.5pt; color: #443f3f;"><span style="background: white;">Done ròi. Nếu chưa cài repo EPEL thì có thể tham khảo EPEL Repo là gì và cách cài.</span></p><p style="margin: 0in; font-family: 'Merriweather Sans'; font-size: 10.0pt; color: #1e1e1e;"><span style="font-weight: bold; background: white;">Cấu hình cơ bản Supervisor</span></p><p style="margin: 0in; font-family: Merriweather; font-size: 14.5pt; color: #443f3f;"><span style="background: white;">Để duy trì một process chạy liên tục, ta có thể dùng một file config cơ bản như sau</span></p><p style="margin: 0in; font-family: Calibri; font-size: 10.0pt; color: #443f3f;"><span style="background: #F1F1F1;">[program:laravel-worker] process_name=%(program_name)s_%(process_num)02d command=/root/sendmail.sh autostart=true autorestart=true user=forge numprocs=8 redirect_stderr=true stdout_logfile=/home/forge/app.com/worker.log</span></p><p style="margin: 0in; font-family: Merriweather; font-size: 14.5pt; color: #443f3f;"><span style="background: white;">trong đó:</span></p><ul style="margin-left: .375in; direction: ltr; unicode-bidi: embed; margin-top: 0in; margin-bottom: 0in;" type="disc"><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-weight: bold; font-family: Merriweather; font-size: 14.5pt; background: white;">[program: tên bất kì</span><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">] là tên(thích gì đặt đó) cho program</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-weight: bold; font-family: Merriweather; font-size: 14.5pt; background: white;">command </span><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">là path tới program cần chạy, ví dụ trên là /root/sendmail.sh</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-weight: bold; font-family: Merriweather; font-size: 14.5pt; background: white;">autostart </span><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">quy định process có tự chạy ngay khi Supervisor được khởi động hay ko. Thường thì Supervisor được chạy khi boot, nên điều này đồng nghĩa với việc quy định process có tự chạy khi boot hay ko.</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-weight: bold; font-family: Merriweather; font-size: 14.5pt; background: white;">autorestart </span><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">quy định process có tự khởi động ngay sau khi nó bị tắt vì lý do nào đó(đã chạy xong, bị lỗi, bị timeout…) hay ko.</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-weight: bold; font-family: Merriweather; font-size: 14.5pt; background: white;">user </span><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">là user dùng để thực thi process</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-weight: bold; font-family: Merriweather; font-size: 14.5pt; background: white;">numprocs </span><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">là số lượng tiến trình của cùng process đó (instances). Ví dụ để gửi mail nhanh hơn thì có thể cho numprocs=4, nghĩa là 4 process cùng chạy task gửi mail.</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-weight: bold; font-family: Merriweather; font-size: 14.5pt; background: white;">redirect_stderr </span><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">nếu set = true thì stderr sẽ bị redirect để xuất vào file chỉ định ở </span><span style="font-weight: bold; font-family: Merriweather; font-size: 14.5pt; background: white;">stdout_logfile</span></li><li style="margin-top: 0; margin-bottom: 0; vertical-align: middle; color: #443f3f;"><span style="font-weight: bold; font-family: Merriweather; font-size: 14.5pt; background: white;">stdout_logfile</span><span style="font-family: Merriweather; font-size: 14.5pt; background: white;">: mọi thứ mà-đáng-lẽ-xuất-ra-màn-hình lúc process được thực thi sẽ xuất vào đây. Ví dụ một process là bash script có lệnh echo gì ấy, thì thay vì echo ra màn hình, nó sẽ đc xuất vào file này. Bao gồm cả stderr nếu redirect_stderr phía trên set=true.</span></li></ul><p style="margin: 0in; font-family: Merriweather; font-size: 14.5pt; color: #443f3f;"><span style="background: white;">File config nằm ở /etc/supervisord.d/ với filename có dạng xyz.ini. Sau khi tạo xong các bạn restart lại Supervisord bằng </span><span style="font-weight: bold; background: white;">systemctl restart supervisord.</span></p></div><footer><div class="post__tags-share"><aside class="post__share"></aside></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://ddtrungit.github.io/centos-6-how-to-fix-centos-6-end-of-line-error-yumrepo-error-all-mirror-urls-are-not-using-ftp-https-or-file/index.html" rel="prev">Previous Post<h3 class="h6">Centos 6: HOW TO FIX CENTOS 6 End of Line ERROR: YUMREPO ERROR: ALL MIRROR URLS ARE NOT USING FTP, HTTP[S] OR FILE</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://ddtrungit.github.io/laravel-horizon/index.html" rel="prev">Next Post<h3 class="h6">Laravel Horizon</h3></a></div></nav></footer></div></article><div class="comments-area post__inner" id="comments"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div class="fb-comments" data-href="https://ddtrungit.github.io/supervisor/" data-width="100%" data-colorscheme="light" data-lazy="true" data-order-by="reverse_time" data-numposts="5"></div><noscript>Please enable JS to use the comments form.</noscript></div></div><div id="fb-root"></div><script type="text/javascript" async defer="defer" crossorigin="anonymous" src="https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v12.0">nonce="n4mWU9e7"</script></div></div></main><footer class="footer"><div class="footer__social"><a href="https://facebook.com/duongtrung2103" aria-label="Facebook" class="facebook"><svg><use xlink:href="https://ddtrungit.github.io/assets/svg/svg-map.svg#facebook"/></svg></a></div><div class="footer__copyright">"DO THE THINGS YOU LOVE!"</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://ddtrungit.github.io/assets/js/scripts.min.js?v=d78591855e0ce96bf51239b499260e20"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>
<!DOCTYPE html><html lang="vi"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Truy tìm nguyên nhân lỗi “Error establishing a database connection” của WordPress - TRUNG DUONG</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><meta name="theme-color" content="#17181E" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#D73A42" media="(prefers-color-scheme: light)"><meta name="msapplication-navbutton-color" content="#D73A42"><meta name="apple-mobile-web-app-status-bar-style" content="#D73A42"><link rel="alternate" type="application/atom+xml" href="http://blog.dtrungit.ga/feed.xml"><link rel="alternate" type="application/json" href="http://blog.dtrungit.ga/feed.json"><link rel="shortcut icon" href="http://blog.dtrungit.ga/media/website/cropped-2019-09-16-32x32.png" type="image/x-icon"><link rel="shortcut icon" href="http://blog.dtrungit.ga/media/website/cropped-2019-09-16-32x32.png" type="image/x-icon"><link rel="stylesheet" href="http://blog.dtrungit.ga/assets/css/style.css?v=4becd99c93342dd7c117b97188f052e6"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.dtrungit.ga/truy-tim-nguyen-nhan-loi-error-establishing-a-database-connection-cua-wordpress/index.html"},"headline":"Truy tìm nguyên nhân lỗi “Error establishing a database connection” của WordPress","datePublished":"2021-01-28T04:03","dateModified":"2022-06-13T14:30","image":{"@type":"ImageObject","url":"http://blog.dtrungit.ga/media/posts/86/best-ways-to-speed-up-wp-site.jpg","height":1080,"width":1920},"description":"Website đang chạy bình thường, bỗng nhiên xuất hiện lỗi “Error establishing a database connection”, lỗi này cho thấy WordPress&hellip;","author":{"@type":"Person","name":"Duong Dinh Trung","url":"http://blog.dtrungit.ga/authors/dtrungit/"},"publisher":{"@type":"Organization","name":"Duong Dinh Trung","logo":{"@type":"ImageObject","url":"http://blog.dtrungit.ga/media/website/Background_2.png","height":800,"width":834}}}</script></head><body><header class="header" id="js-header"><a href="http://blog.dtrungit.ga/index.html" class="logo"><img src="http://blog.dtrungit.ga/media/website/Background_2.png" alt="TRUNG DUONG"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="http://blog.dtrungit.ga/index.html" target="_self">Home</a></li><li><a href="http://blog.dtrungit.ga/lien-he/index.html" target="_self">Contact</a></li><li><a href="http://blog.dtrungit.ga/gioi-thieu/index.html" target="_self">About</a></li><li><a href="http://blog.dtrungit.ga/tags/aws/index.html" target="_self">AWS</a></li><li><a href="http://blog.dtrungit.ga/tags/oracle/index.html" target="_self">Oracle</a></li><li class="has-submenu"><a href="http://blog.dtrungit.ga/tags/linux/index.html" target="_self" aria-haspopup="true">Linux</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="http://blog.dtrungit.ga/tags/ansible/index.html" target="_self">Ansible</a></li><li><a href="http://blog.dtrungit.ga/tags/k8s/index.html" target="_self">Kubernetes</a></li><li><a href="http://blog.dtrungit.ga/tags/oracle/index.html" target="_self">Oracle</a></li><li><a href="http://blog.dtrungit.ga/tags/zimbra/index.html" target="_self">Zimbra</a></li><li><a href="http://blog.dtrungit.ga/tags/tip/index.html" target="_self">TIP</a></li></ul></li></ul></nav></header><main><div class="wrapper"><article class="post"><header class="post__header"><h1 class="post__title">Truy tìm nguyên nhân lỗi “Error establishing a database connection” của WordPress</h1><div class="post__meta"><div class="post__author">By <a href="http://blog.dtrungit.ga/authors/dtrungit/index.html" class="invert" rel="author" title="Duong Dinh Trung">Duong Dinh Trung</a></div><div class="post__comments"><a href="http://blog.dtrungit.ga/truy-tim-nguyen-nhan-loi-error-establishing-a-database-connection-cua-wordpress/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="http://blog.dtrungit.ga/assets/svg/svg-map.svg#comments"/></svg></a></div></div></header><figure class="post__featured-image"><img src="http://blog.dtrungit.ga/media/posts/86/best-ways-to-speed-up-wp-site.jpg" srcset="http://blog.dtrungit.ga/media/posts/86/responsive/best-ways-to-speed-up-wp-site-xs.jpg 300w, http://blog.dtrungit.ga/media/posts/86/responsive/best-ways-to-speed-up-wp-site-sm.jpg 480w, http://blog.dtrungit.ga/media/posts/86/responsive/best-ways-to-speed-up-wp-site-md.jpg 768w, http://blog.dtrungit.ga/media/posts/86/responsive/best-ways-to-speed-up-wp-site-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="eager" height="1080" width="1920" alt=""></figure><div class="post__inner"><div class="post__entry"><p></p><p>Website đang chạy bình thường, bỗng nhiên xuất hiện lỗi “Error establishing a database connection”, lỗi này cho thấy WordPress không thể kết nối được Database, trong nhiều trường hợp, chỉ cần restart lại service MySQL sẽ hoạt động lại bình thường.</p><p></p><p></p><p>Có nhiều nguyên nhân dẫn đến lỗi này, hôm nay mình chia sẻ với các bạn 1 case thực tế mình vừa gặp sáng nay và cách xác định nguyên nhân chính dẫn đến lỗi để có hướng khắc phục triệt để.</p><p></p><p></p><p>Khi bị lỗi, vào kiểm tra thấy dịch vụ MySQL đã bị stop, phóng ngay lệnh “<strong><em>dmesg</em></strong>” để xem log của hệ thống, phát hiện OOM Killer (Out Of Memory Killer) đã kill process MySQL:</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-356"><img loading="lazy" src="http://blog.dtrungit.ga/media/posts/86/oom_1.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="http://blog.dtrungit.ga/media/posts/86/responsive/oom_1-xs.png 300w, http://blog.dtrungit.ga/media/posts/86/responsive/oom_1-sm.png 480w, http://blog.dtrungit.ga/media/posts/86/responsive/oom_1-md.png 768w" alt=""></figure></figure><p></p><p></p><p>Trước mắt, đã xác định được nguyên nhân MySQL bị stop là do OOM Killer. Hãy nhìn kỹ vào thông báo trên, một số thông tin quan trọng cần phải để ý:</p><p></p><p></p><ul><li>Out of memory: Kill process 27657 (mysqld): Confirm lại chính OOM đã kill mysqld khi hệ thống bị hết RAM.</li><li>Số lượng process httpd được sinh ra rất nhiều: đây chính là nguyên nhân gây hết RAM.</li><li>Process httpd được sinh ra bởi user có UID là 501, đây là thông tin cực kỳ quan trọng</li></ul><p></p><p></p><p>Tìm user có UID 501:</p><p></p><p></p><pre class="wp-block-code"><code>$ grep 501 /etc/passwd</code></pre><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-357"><img loading="lazy" src="http://blog.dtrungit.ga/media/posts/86/oom_user.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="http://blog.dtrungit.ga/media/posts/86/responsive/oom_user-xs.png 300w, http://blog.dtrungit.ga/media/posts/86/responsive/oom_user-sm.png 480w, http://blog.dtrungit.ga/media/posts/86/responsive/oom_user-md.png 768w" alt=""></figure></figure><p></p><p></p><p>Khi đã xác định được user, việc tiếp theo là cần check httpd log của user trên (do số lượng process httpd của user trên vào thời điểm lỗi nhiều bất thường). Tuy nhiên, do dmesg log không ghi lại thời gian cụ thể, cần check tiếp message log</p><p></p><p></p><pre class="wp-block-code"><code>$ tail -n 200 /var/log/message</code></pre><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-358"><img loading="lazy" src="http://blog.dtrungit.ga/media/posts/86/oom_2-1024x783.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="http://blog.dtrungit.ga/media/posts/86/responsive/oom_2-1024x783-xs.png 300w, http://blog.dtrungit.ga/media/posts/86/responsive/oom_2-1024x783-sm.png 480w, http://blog.dtrungit.ga/media/posts/86/responsive/oom_2-1024x783-md.png 768w" alt=""></figure></figure><p></p><p></p><p>Thời gian được xác định là “05:08:08”, đây là thời điểm OOM được kích hoạt, vậy cần phải khoanh vùng các truy cập vào Website của user admin trong khoảng thời gian từ “05:08:08” trở về trước</p><p></p><p></p><p>Sau khi check log cách đó khoảng 1p30s thì phát hiện:</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-360"><img loading="lazy" src="http://blog.dtrungit.ga/media/posts/86/oom_3-1-1024x513.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="http://blog.dtrungit.ga/media/posts/86/responsive/oom_3-1-1024x513-xs.png 300w, http://blog.dtrungit.ga/media/posts/86/responsive/oom_3-1-1024x513-sm.png 480w, http://blog.dtrungit.ga/media/posts/86/responsive/oom_3-1-1024x513-md.png 768w" alt=""></figure></figure><p></p><p></p><p>Vào thời điểm trên, có 1 loạt log nhìn rất bất thường, vì sao?</p><p></p><p></p><ul><li>Các truy cập vào chung 1 URL có pattern là “<em>/?add_to_wishlist=xxxx</em>“</li><li>Truy cập xuất phát từ nhiều IP khác nhau nhưng lại chung 1 User-Agent</li><li>Sử dụng cùng HTTP 1.0</li><li>Các IP trên khi load URL KHÔNG load kèm theo các static resources như css, js</li></ul><p></p><p></p><p>Nhiêu đây thông tin đã giúp tôi hình dung ra được cách thức cũng như mục tiêu của sự cố, theo bạn thì website này đang bị gì? Mục tiêu và cách thức ra sao?</p><p></p><p></p><p>Hãy cho tôi biết kết quả của bạn nhé, giờ tôi phải start lại dịch vụ cho khách hàng và điều chỉnh config để giải quyết cho họ rồi :D.</p><p></p></div><footer><div class="post__tags-share"><aside class="post__share"></aside></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="http://blog.dtrungit.ga/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html" rel="prev">Previous Post<h3 class="h6">TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO?</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="http://blog.dtrungit.ga/toi-uu-wordpress-bi-cham/index.html" rel="prev">Next Post<h3 class="h6">TỐI ƯU WORDPRESS BỊ CHẬM</h3></a></div></nav></footer></div></article><div class="comments-area post__inner" id="comments"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div class="fb-comments" data-href="http://blog.dtrungit.ga/truy-tim-nguyen-nhan-loi-error-establishing-a-database-connection-cua-wordpress/" data-width="100%" data-colorscheme="light" data-lazy="true" data-order-by="reverse_time" data-numposts="5"></div><noscript>Please enable JS to use the comments form.</noscript></div></div><div id="fb-root"></div><script type="text/javascript" async defer="defer" crossorigin="anonymous" src="https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v12.0">nonce="n4mWU9e7"</script></div></div><div class="post__related"><div class="wrapper"><h2 class="h5">Related posts</h2><div class="l-grid l-grid--4"><article class="c-card"><a href="http://blog.dtrungit.ga/hieu-ro-ve-quyen-truy-cap-tep-trong-linux/index.html" class="c-card__image"><img src="http://blog.dtrungit.ga/media/posts/111/setfacl.webp" srcset="http://blog.dtrungit.ga/media/posts/111/responsive/setfacl-xs.webp 300w, http://blog.dtrungit.ga/media/posts/111/responsive/setfacl-sm.webp 480w, http://blog.dtrungit.ga/media/posts/111/responsive/setfacl-md.webp 768w, http://blog.dtrungit.ga/media/posts/111/responsive/setfacl-lg.webp 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="300" width="300" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="http://blog.dtrungit.ga/tags/tip/index.html">Tip</a></div><h3 class="c-card__title"><a href="http://blog.dtrungit.ga/hieu-ro-ve-quyen-truy-cap-tep-trong-linux/index.html" class="invert">Hiểu rõ về quyền truy cập tệp trong linux</a></h3></header><p class="c-card__text">Khi làm việc với điều hành Linux thi thoảng bạn nhận được message tựa tựa thế này 'Permission denied' và&hellip;</p><footer class="c-card__meta"><div class="c-card__comments"><a href="http://blog.dtrungit.ga/hieu-ro-ve-quyen-truy-cap-tep-trong-linux/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="http://blog.dtrungit.ga/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article><article class="c-card"><a href="http://blog.dtrungit.ga/huong-dan-debug-bang-strace-url-wordpress/index.html" class="c-card__image"><img src="http://blog.dtrungit.ga/media/posts/89/best-ways-to-speed-up-wp-site.jpg" srcset="http://blog.dtrungit.ga/media/posts/89/responsive/best-ways-to-speed-up-wp-site-xs.jpg 300w, http://blog.dtrungit.ga/media/posts/89/responsive/best-ways-to-speed-up-wp-site-sm.jpg 480w, http://blog.dtrungit.ga/media/posts/89/responsive/best-ways-to-speed-up-wp-site-md.jpg 768w, http://blog.dtrungit.ga/media/posts/89/responsive/best-ways-to-speed-up-wp-site-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="1080" width="1920" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="http://blog.dtrungit.ga/tags/tip/index.html">Tip</a></div><h3 class="c-card__title"><a href="http://blog.dtrungit.ga/huong-dan-debug-bang-strace-url-wordpress/index.html" class="invert">Hướng dẫn debug bằng strace URL WordPress</a></h3></header><p class="c-card__text">Sau khi chia sẻ loạt bài debug WordPress bằng cách sử dụng strace để xem chi tiết quá trình xử&hellip;</p><footer class="c-card__meta"><div class="c-card__comments"><a href="http://blog.dtrungit.ga/huong-dan-debug-bang-strace-url-wordpress/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="http://blog.dtrungit.ga/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article><article class="c-card"><a href="http://blog.dtrungit.ga/toi-uu-wordpress-bi-cham/index.html" class="c-card__image"><img src="http://blog.dtrungit.ga/media/posts/87/best-ways-to-speed-up-wp-site.jpg" srcset="http://blog.dtrungit.ga/media/posts/87/responsive/best-ways-to-speed-up-wp-site-xs.jpg 300w, http://blog.dtrungit.ga/media/posts/87/responsive/best-ways-to-speed-up-wp-site-sm.jpg 480w, http://blog.dtrungit.ga/media/posts/87/responsive/best-ways-to-speed-up-wp-site-md.jpg 768w, http://blog.dtrungit.ga/media/posts/87/responsive/best-ways-to-speed-up-wp-site-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="1080" width="1920" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="http://blog.dtrungit.ga/tags/tip/index.html">Tip</a></div><h3 class="c-card__title"><a href="http://blog.dtrungit.ga/toi-uu-wordpress-bi-cham/index.html" class="invert">TỐI ƯU WORDPRESS BỊ CHẬM</a></h3></header><p class="c-card__text">ừa rồi tôi được giao nhiệm vụ kiểm tra và tối ưu System cho blog WordPress của doanh nghiệp trong&hellip;</p><footer class="c-card__meta"><div class="c-card__comments"><a href="http://blog.dtrungit.ga/toi-uu-wordpress-bi-cham/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="http://blog.dtrungit.ga/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article><article class="c-card"><a href="http://blog.dtrungit.ga/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html" class="c-card__image"><img src="http://blog.dtrungit.ga/media/posts/85/best-ways-to-speed-up-wp-site.jpg" srcset="http://blog.dtrungit.ga/media/posts/85/responsive/best-ways-to-speed-up-wp-site-xs.jpg 300w, http://blog.dtrungit.ga/media/posts/85/responsive/best-ways-to-speed-up-wp-site-sm.jpg 480w, http://blog.dtrungit.ga/media/posts/85/responsive/best-ways-to-speed-up-wp-site-md.jpg 768w, http://blog.dtrungit.ga/media/posts/85/responsive/best-ways-to-speed-up-wp-site-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="1080" width="1920" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="http://blog.dtrungit.ga/tags/tip/index.html">Tip</a></div><h3 class="c-card__title"><a href="http://blog.dtrungit.ga/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html" class="invert">TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO?</a></h3></header><p class="c-card__text">Tuy nhiên, mỗi website sẽ có 1 đặc điểm riêng, không phải site nào tối ưu cũng giống site nào,&hellip;</p><footer class="c-card__meta"><div class="c-card__comments"><a href="http://blog.dtrungit.ga/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="http://blog.dtrungit.ga/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://facebook.com/duongtrung2103" aria-label="Facebook" class="facebook"><svg><use xlink:href="http://blog.dtrungit.ga/assets/svg/svg-map.svg#facebook"/></svg></a></div><div class="footer__copyright">"DO THE THINGS YOU LOVE!"</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="http://blog.dtrungit.ga/assets/js/scripts.min.js?v=d78591855e0ce96bf51239b499260e20"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>
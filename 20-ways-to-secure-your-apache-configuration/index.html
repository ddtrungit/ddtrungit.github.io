<!DOCTYPE html><html lang="vi"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>20 ways to Secure your Apache Configuration - TRUNG DUONG</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="alternate" type="application/atom+xml" href="https://ddtrungit.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://ddtrungit.github.io/feed.json"><link rel="stylesheet" href="https://ddtrungit.github.io/assets/css/style.css?v=6ddec22a33b6e591633ba53617c15038"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ddtrungit.github.io/20-ways-to-secure-your-apache-configuration/index.html"},"headline":"20 ways to Secure your Apache Configuration","datePublished":"2021-01-22T09:12","dateModified":"2022-06-13T14:31","image":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/posts/66/ApacheSecurity.png","height":500,"width":700},"description":"Here are 20 things you can do to make your apache configuration more secure. Disclaimer: The thing about security is&hellip;","author":{"@type":"Person","name":"Duong Dinh Trung","url":"https://ddtrungit.github.io/authors/dtrungit/"},"publisher":{"@type":"Organization","name":"Duong Dinh Trung","logo":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/website/Background_2.png","height":800,"width":834}}}</script></head><body><header class="header" id="js-header"><a href="https://ddtrungit.github.io/index.html" class="logo"><img src="https://ddtrungit.github.io/media/website/Background_2.png" alt="TRUNG DUONG"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://ddtrungit.github.io/index.html" target="_self">Home</a></li><li><a href="https://ddtrungit.github.io/lien-he/index.html" target="_self">Contact</a></li><li><a href="https://ddtrungit.github.io/gioi-thieu/index.html" target="_self">About</a></li><li><a href="https://ddtrungit.github.io/tags/ansible/index.html" target="_self">Ansible</a></li><li><a href="https://ddtrungit.github.io/tags/aws/index.html" target="_self">AWS</a></li><li><a href="https://ddtrungit.github.io/tags/oracle/index.html" target="_self">Oracle</a></li><li><a href="https://ddtrungit.github.io/tags/linux/index.html" target="_self">Linux</a></li><li><a href="https://ddtrungit.github.io/tags/zimbra/index.html" target="_self">Zimbra</a></li><li><a href="https://ddtrungit.github.io/tags/tip/index.html" target="_self">TIP</a></li></ul></nav></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://ddtrungit.github.io/tags/tip/index.html" class="post__maintag">Tip</a><h1 class="post__title">20 ways to Secure your Apache Configuration</h1><div class="post__meta"><div class="post__author">By <a href="https://ddtrungit.github.io/authors/dtrungit/index.html" class="invert" rel="author" title="Duong Dinh Trung">Duong Dinh Trung</a></div></div></header><figure class="post__featured-image"><img src="https://ddtrungit.github.io/media/posts/66/ApacheSecurity.png" srcset="https://ddtrungit.github.io/media/posts/66/responsive/ApacheSecurity-xs.png 300w, https://ddtrungit.github.io/media/posts/66/responsive/ApacheSecurity-sm.png 480w, https://ddtrungit.github.io/media/posts/66/responsive/ApacheSecurity-md.png 768w, https://ddtrungit.github.io/media/posts/66/responsive/ApacheSecurity-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="eager" height="500" width="700" alt=""></figure><div class="post__inner"><div class="post__entry"><p></p><p>Here are 20 things you can do to make your apache configuration more secure.</p><p></p><p></p><p>Disclaimer: The thing about security is that there are no guarantees or absolutes. These suggestions should make your server a bit tighter, but don't think your server is necessarily secure after following these suggestions.</p><p></p><p></p><p>Additionally some of these suggestions may decrease performance, or cause problems due to your environment. It is up to you to determine if any of the changes I suggest are not compatible with your requirements. In other words proceed at your own risk.</p><p></p><p></p><h3>First, make sure you've installed latest security patches</h3><p></p><p></p><p>There is no sense in putting locks on the windows, if your door is wide open. As such, if you're not patched up there isn't really much point in continuing any longer on this list. Go ahead and <em>bookmark this page</em> so you can come back later, and patch your server.</p><p></p><p></p><p>You'll need a way to know when new Apache Server vulnerabilities are published. I like to <a href="https://stack.watch/product/apache/http-server/">use stack.watch to notify me when new Apache httpd server vulnerabilities are published</a>. The service is free, and will send you an email whenever new vulnerabilities exist.</p><p></p><p></p><h3>Hide the Apache Version number, and other sensitive information.</h3><p></p><p></p><p>By default many Apache installations tell the world what version of Apache you're running, what operating system/version you're running, and even what Apache Modules are installed on the server. Attackers can use this information to their advantage when performing an attack. It also sends the message that you have left most defaults alone.</p><p></p><p></p><p>There are two directives that you need to add, or edit in your <code>httpd.conf</code> file:</p><p></p><p></p><pre class="wp-block-preformatted">ServerSignature OffServerTokens Prod</pre><p></p><p></p><p>The <code>ServerSignature</code> appears on the bottom of pages generated by apache such as 404 pages, directory listings, etc.</p><p></p><p></p><p>The <code>ServerTokens</code> directive is used to determine what Apache will put in the <code>Server</code> HTTP response header. By setting it to <code>Prod</code> it sets the HTTP response header as follows:</p><p></p><p></p><pre class="wp-block-preformatted">Server: Apache</pre><p></p><p></p><p>If you're super paranoid you could change this to something other than "Apache" by editing the source code, or by using mod_security (see below).</p><p></p><p></p><h3>Make sure apache is running under its own user account and group</h3><p></p><p></p><p>Several apache installations have it run as the user <code>nobody</code>. So suppose both Apache, and your mail server were running as <code>nobody</code> an attack through Apache may allow the mail server to also be compromised, and vise versa.</p><p></p><p></p><pre class="wp-block-preformatted">User apacheGroup apache</pre><p></p><p></p><h3>Ensure that files outside the web root are not served</h3><p></p><p></p><p>We don't want apache to be able to access any files out side of its web root. So assuming all your web sites are placed under one directory (we will call this <code>/web</code>), you would set it up as follows:</p><p></p><p></p><pre class="wp-block-preformatted">&lt;Directory /&gt;  Order Deny,Allow  Deny from all  Options None  AllowOverride None&lt;/Directory&gt;&lt;Directory /web&gt;  Order Allow,Deny  Allow from all&lt;/Directory&gt;</pre><p></p><p></p><blockquote class="wp-block-quote"><p>Note that because we set <code>Options None</code> and <code>AllowOverride None</code> this will turn off all options and overrides for the server. You now have to add them explicitly for each directory that requires an Option or Override.</p></blockquote><p></p><p></p><h3>Turn off directory browsing</h3><p></p><p></p><p>You can do this with an <code>Options</code> directive inside a <code>Directory</code> tag. Set <code>Options</code> to either <code>None</code> or <code>-Indexes</code></p><p></p><p></p><pre class="wp-block-preformatted">Options -Indexes</pre><p></p><p></p><h3>Turn off server side includes</h3><p></p><p></p><p>This is also done with the <code>Options</code> directive inside a <code>Directory</code> tag. Set <code>Options</code> to either <code>None</code> or <code>-Includes</code></p><p></p><p></p><pre class="wp-block-preformatted">Options -Includes</pre><p></p><p></p><h3>Turn off CGI execution</h3><p></p><p></p><p>If you're not using CGI turn it off with the <code>Options</code> directive inside a <code>Directory</code> tag. Set <code>Options</code> to either <code>None</code> or <code>-ExecCGI</code></p><p></p><p></p><pre class="wp-block-preformatted">Options -ExecCGI</pre><p></p><p></p><h3>Don't allow apache to follow symbolic links</h3><p></p><p></p><p>This can again can be done using the <code>Options</code> directive inside a <code>Directory</code> tag. Set <code>Options</code> to either <code>None</code> or <code>-FollowSymLinks</code></p><p></p><p></p><pre class="wp-block-preformatted">Options -FollowSymLinks</pre><p></p><p></p><h3>Turning off multiple Options</h3><p></p><p></p><p>If you want to turn off all <code>Options</code> simply use:</p><p></p><p></p><pre class="wp-block-preformatted">Options None</pre><p></p><p></p><p>If you only want to turn off some separate each option with a space in your <code>Options</code> directive:</p><p></p><p></p><pre class="wp-block-preformatted">Options -ExecCGI -FollowSymLinks -Indexes</pre><p></p><p></p><h3>Turn off support for .htaccess files</h3><p></p><p></p><p>This is done in a <code>Directory</code> tag but with the <code>AllowOverride</code> directive. Set it to <code>None</code>.</p><p></p><p></p><pre class="wp-block-preformatted">AllowOverride None</pre><p></p><p></p><p>If you require Overrides ensure that they cannot be downloaded, and/or change the name to something other than <code>.htaccess</code>. For example we could change it to <code>.httpdoverride</code>, and block all files that start with <code>.ht</code> from being downloaded as follows:</p><p></p><p></p><pre class="wp-block-preformatted">AccessFileName .httpdoverride&lt;Files ~ "^\.ht"&gt;    Order allow,deny    Deny from all    Satisfy All&lt;/Files&gt;</pre><p></p><p></p><h3>Run mod_security</h3><p></p><p></p><p><a href="http://www.modsecurity.org/">mod_security</a> is a super handy Apache module written by Ivan Ristic, the author of <a href="http://spendfish.com/product/0596007248">Apache Security</a> from O'Reilly press.</p><p></p><p></p><p>You can do the following with mod_security:</p><p></p><p></p><ul><li>Simple filtering</li><li>Regular Expression based filtering</li><li>URL Encoding Validation</li><li>Unicode Encoding Validation</li><li>Auditing</li><li>Null byte attack prevention</li><li>Upload memory limits</li><li>Server identity masking</li><li>Built in Chroot support</li><li>And more</li></ul><p></p><p></p><h3>Disable any unnecessary modules</h3><p></p><p></p><p>Apache typically comes with several modules installed. Go through the apache <a href="http://httpd.apache.org/docs/2.0/mod/">module documentation</a> and learn what each module you have enabled actually does. Many times you will find that you don't need to have the said module enabled.</p><p></p><p></p><p>Look for lines in your <code>httpd.conf</code> that contain <code>LoadModule</code>. To disable the module you can typically just add a <code>#</code> at the beginning of the line. To search for modules run:</p><p></p><p></p><pre class="wp-block-preformatted">grep LoadModule httpd.conf</pre><p></p><p></p><p>Here are some modules that are typically enabled but often not needed: <code>mod_imap</code>, <code>mod_include</code>, <code>mod_info</code>, <code>mod_userdir</code>, <code>mod_status</code>, <code>mod_cgi</code>, <code>mod_autoindex</code>.</p><p></p><p></p><h3>Make sure only root has read access to apache's config and binaries</h3><p></p><p></p><p>This can be done assuming your apache installation is located at <code>/usr/local/apache</code> as follows:</p><p></p><p></p><pre class="wp-block-preformatted">chown -R root:root /usr/local/apachechmod -R o-rwx /usr/local/apache</pre><p></p><p></p><h3>Lower the Timeout value</h3><p></p><p></p><p>By default the <code>Timeout</code> directive is set to 300 seconds. You can decrease help mitigate the potential effects of a denial of service attack.</p><p></p><p></p><pre class="wp-block-preformatted">Timeout 45</pre><p></p><p></p><h3>Limiting large requests</h3><p></p><p></p><p>Apache has several directives that allow you to limit the size of a request, this can also be useful for mitigating the effects of a denial of service attack.</p><p></p><p></p><p>A good place to start is the <code>LimitRequestBody</code> directive. This directive is set to unlimited by default. If you are allowing file uploads of no larger than 1MB, you could set this setting to something like:</p><p></p><p></p><pre class="wp-block-preformatted">LimitRequestBody 1048576</pre><p></p><p></p><p>If you're not allowing file uploads you can set it even smaller.</p><p></p><p></p><p>Some other directives to look at are <code>LimitRequestFields</code>, <code>LimitRequestFieldSize</code> and <code>LimitRequestLine</code>. These directives are set to a reasonable defaults for most servers, but you may want to tweak them to best fit your needs. See the <a href="http://httpd.apache.org/docs/2.0/mod/core.html">documentation</a> for more info.</p><p></p><p></p><h3>Limiting the size of an XML Body</h3><p></p><p></p><p>If you're running <code>mod_dav</code> (typically used with subversion) then you may want to limit the max size of an XML request body. The <code>LimitXMLRequestBody</code> directive is only available on Apache 2, and its default value is 1 million bytes (approx 1mb). Many tutorials will have you set this value to 0 which means files of any size may be uploaded, which may be necessary if you're using WebDAV to upload large files, but if you're simply using it for source control, you can probably get away with setting an upper bound, such as 10mb:</p><p></p><p></p><pre class="wp-block-preformatted">LimitXMLRequestBody 10485760</pre><p></p><p></p><h3>Limiting Concurrency</h3><p></p><p></p><p>Apache has several configuration settings that can be used to adjust handling of concurrent requests. The <code>MaxClients</code> is the maximum number of child processes that will be created to serve requests. This may be set too high if your server doesn't have enough memory to handle a large number of concurrent requests.</p><p></p><p></p><p>Other directives such as <code>MaxSpareServers</code>, <code>MaxRequestsPerChild</code>, and on Apache2 <code>ThreadsPerChild</code>, <code>ServerLimit</code>, and <code>MaxSpareThreads</code> are important to adjust to match your operating system, and hardware.</p><p></p><p></p><h3>Restricting Access by IP</h3><p></p><p></p><p>If you have a resource that should only by accessed by a certain network, or IP address you can enforce this in your apache configuration. For instance if you want to restrict access to your intranet to allow only the 176.16 network:</p><p></p><p></p><pre class="wp-block-preformatted">Order Deny,AllowDeny from allAllow from 176.16.0.0/16</pre><p></p><p></p><p>Or by IP:</p><p></p><p></p><pre class="wp-block-preformatted">Order Deny,AllowDeny from allAllow from 127.0.0.1</pre><p></p><p></p><h3>Adjusting KeepAlive settings</h3><p></p><p></p><p>According to the Apache documentation using HTTP Keep Alive's can improve client performance by as much as 50%, so be careful before changing these settings, you will be trading performance for a slight denial of service mitigation.</p><p></p><p></p><p>KeepAlive's are turned on by default and you should leave them on, but you may consider changing the <code>MaxKeepAliveRequests</code> which defaults to <code>100</code>, and the <code>KeepAliveTimeout</code> which defaults to <code>15</code>. Analyze your log files to determine the appropriate values.</p><p></p><p></p><h3>Run Apache in a Chroot environment</h3><p></p><p></p><p><code>chroot</code> allows you to run a program in its own isolated <em>jail</em>. This prevents a break in on one service from being able to effect anything else on the server.</p><p></p><p></p><p>It can be fairly tricky to set this up using <code>chroot</code> due to library dependencies. I mentioned above that the <code>mod_security</code> module has built in chroot support. It makes the process as simple as adding a <code>mod_security</code> directive to your configuration:</p><p></p><p></p><pre class="wp-block-preformatted">SecChrootDir /chroot/apache</pre><p></p><p></p><p>There are however some caveats however, so check out the mod_security docs for more info.</p><p></p><p></p><h4>Acknowledgments</h4><p></p><p></p><p>I have found the book <a href="http://spendfish.com/product/0596007248">Apache Security</a> to be a highly valuable resource for securing an apache web server. Some of the suggestions listed above were inspired by this book.</p><p></p><p></p><h4>Suggestions</h4><p></p><p></p><p>Please post any suggestions, caveats, or corrections in the comments and I will update the post if necessary.</p><p></p></div><footer><div class="post__tags-share"><aside class="post__share"></aside></div></footer></div></article></div></main><footer class="footer"><div class="footer__social"><a href="https://facebook.com/duongtrung2103" aria-label="Facebook" class="facebook"><svg><use xlink:href="https://ddtrungit.github.io/assets/svg/svg-map.svg#facebook"/></svg></a></div><div class="footer__copyright">"DO THE THINGS YOU LOVE!"</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://ddtrungit.github.io/assets/js/scripts.min.js?v=d78591855e0ce96bf51239b499260e20"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>
<!DOCTYPE html><html lang="vi"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CSF cài đặt cấu hình firewall cho server - TRUNG DUONG</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><meta name="theme-color" content="#17181E" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#D73A42" media="(prefers-color-scheme: light)"><meta name="msapplication-navbutton-color" content="#D73A42"><meta name="apple-mobile-web-app-status-bar-style" content="#D73A42"><link rel="alternate" type="application/atom+xml" href="https://ddtrungit.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://ddtrungit.github.io/feed.json"><link rel="shortcut icon" href="https://ddtrungit.github.io/media/website/cropped-2019-09-16-32x32.png" type="image/x-icon"><link rel="shortcut icon" href="https://ddtrungit.github.io/media/website/cropped-2019-09-16-32x32.png" type="image/x-icon"><link rel="stylesheet" href="https://ddtrungit.github.io/assets/css/style.css?v=4becd99c93342dd7c117b97188f052e6"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ddtrungit.github.io/csf-cai-dat-cau-hinh-firewall-cho-server/index.html"},"headline":"CSF cài đặt cấu hình firewall cho server","datePublished":"2021-01-27T08:03","dateModified":"2022-06-13T14:32","image":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/posts/73/csf-la-gi.jpg","height":296,"width":675},"description":"CSF và lfd có chức năng firewall làm việc cùng iptables để bảo mật, giám sát hệ thống, ngăn chặn&hellip;","author":{"@type":"Person","name":"Duong Dinh Trung","url":"https://ddtrungit.github.io/authors/dtrungit/"},"publisher":{"@type":"Organization","name":"Duong Dinh Trung","logo":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/website/Background_2.png","height":800,"width":834}}}</script></head><body><header class="header" id="js-header"><a href="https://ddtrungit.github.io/index.html" class="logo"><img src="https://ddtrungit.github.io/media/website/Background_2.png" alt="TRUNG DUONG"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://ddtrungit.github.io/index.html" target="_self">Home</a></li><li><a href="https://ddtrungit.github.io/lien-he/index.html" target="_self">Contact</a></li><li><a href="https://ddtrungit.github.io/gioi-thieu/index.html" target="_self">About</a></li><li><a href="https://ddtrungit.github.io/tags/ansible/index.html" target="_self">Ansible</a></li><li><a href="https://ddtrungit.github.io/tags/aws/index.html" target="_self">AWS</a></li><li><a href="https://ddtrungit.github.io/tags/oracle/index.html" target="_self">Oracle</a></li><li><a href="https://ddtrungit.github.io/tags/linux/index.html" target="_self">Linux</a></li><li><a href="https://ddtrungit.github.io/tags/zimbra/index.html" target="_self">Zimbra</a></li><li><a href="https://ddtrungit.github.io/tags/tip/index.html" target="_self">TIP</a></li><li><a href="https://ddtrungit.github.io/tags/k8s/index.html" target="_self">Kubernetes</a></li></ul></nav></header><main><div class="wrapper"><article class="post"><header class="post__header"><h1 class="post__title">CSF cài đặt cấu hình firewall cho server</h1><div class="post__meta"><div class="post__author">By <a href="https://ddtrungit.github.io/authors/dtrungit/index.html" class="invert" rel="author" title="Duong Dinh Trung">Duong Dinh Trung</a></div><div class="post__comments"><a href="https://ddtrungit.github.io/csf-cai-dat-cau-hinh-firewall-cho-server/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://ddtrungit.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></div></header><figure class="post__featured-image"><img src="https://ddtrungit.github.io/media/posts/73/csf-la-gi.jpg" srcset="https://ddtrungit.github.io/media/posts/73/responsive/csf-la-gi-xs.jpg 300w, https://ddtrungit.github.io/media/posts/73/responsive/csf-la-gi-sm.jpg 480w, https://ddtrungit.github.io/media/posts/73/responsive/csf-la-gi-md.jpg 768w, https://ddtrungit.github.io/media/posts/73/responsive/csf-la-gi-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="eager" height="296" width="675" alt=""></figure><div class="post__inner"><div class="post__entry"><p></p><p class="has-drop-cap">CSF và lfd có chức năng firewall làm việc cùng iptables để bảo mật, giám sát hệ thống, ngăn chặn truy cập trái phép, chống lại DOSS, brutefore …</p><p></p><p></p><p>ConfigServer Firewall (csf)</p><p></p><p></p><p>CSF là một firewall, nó giám sát trạng thái các kết nối đang hoạt động, nó sử dụng trạng thái giám sát được đẻ quyết định cho phép các gói tin đi qua firewall hay không. CSF cũng giám sát việc xác thực Login trên hệ thống (ví dụ login ftp 3 lần sai sẽ bí block IP), cũng như bảo mật các ứng dụng trên Server Linux</p><p></p><p></p><p>Cài đặt CSF (CentOS / RHEL)</p><p></p><p></p><p># yum install wget bind-utils -y  &amp; update -y<br># yum install perl-libwww-perl net-tools perl-LWP-Protocol-https -y</p><p></p><p></p><p># yum install perl-libwww-perl<br># apt install libwww-perl</p><p></p><p></p><p># cd scr_csf &amp; mkdir scr_csf<br># wget <a href="https://download.configserver.com/csf.tgz">https://download.configserver.com/csf.tgz</a><br># tar -xzf csf.tgz<br># cd csf<br># sh install.sh</p><p></p><p></p><p>Sau khi cài xong, cần kiểm tra server đã có đủ các module để CSF làm việc không bằng lệnh: </p><p></p><p></p><p># perl /usr/local/csf/bin/csftest.pl</p><p></p><p></p><p>Nếu không có báo lỗi nào thì đã thành công. Trên CentOS 7 có thể tắt firewall mặc định firewalld</p><p></p><p></p><p># systemctl stop firewalld</p><p></p><p></p><p>#Thậm chí tắt hẳn chế độ chạy tự động<br># systemctl disable firewalld</p><p></p><p></p><p>Nếu muốn gỡ bỏ CSF thì dùng lệnh:</p><p></p><p></p><p># sh /etc/csf/uninstall.sh</p><p></p><p></p><p>Cấu hình và sử dụng</p><p></p><p></p><p>Cấu hình chính lưu tại /etc/csf/csf.conf</p><p></p><p></p><p>Đầu tiên mở csf.conf tìm và thiết lập cấu hình TEST</p><p></p><p></p><p># vi /etc/csf/csf.conf<br>TESTING = "1"<br>RESTRICT_SYSLOG = "3"</p><p></p><p></p><p>Nạp lại CSF</p><p></p><p></p><p># csf -r</p><p></p><p></p><ul><li>csf.conf : File cấu hình chính để quản lý CSF.</li><li>csf.allow : Danh sách địa chỉ IP cho phép qua firewall.</li><li>csf.deny : Danh sách địa chỉ IP từ chối qua firewall.</li><li>csf.ignore : Danh sách địa chỉ IP cho phép qua firewall và không bị block nếu có vấn đề.</li><li>csf.*ignore : Danh sách user, IP được ignore</li></ul><p></p><p></p><figure class="wp-block-table"><table><tbody><tr><td><strong>Lệnh</strong></td><td><strong>Tác dụng</strong></td></tr><tr><td>csf -h</td><td>Trợ giúp lệnh</td></tr><tr><td>csf -s</td><td>Chạy firewall</td></tr><tr><td>csf -f</td><td>Dừng - Flush firewall</td></tr><tr><td>csf -r</td><td>Nạp lại CSF (nhất là sau khi thay đổi cấu hình, thiết lập)</td></tr><tr><td>csf -l</td><td>Hiện thị các luật iptables (IP4)</td></tr><tr><td>csf -p</td><td>Kiểm tra các port đang mở</td></tr><tr><td>csf --lfd</td><td>với tham số [stop|start|restart|status] để điều khiện, chạy, dừng dịch vụ lfd. Dịch vụ này giám sát quá trình đăng nhập (kiểm tra xem nó có đang hoạt động csf --lfd status)</td></tr><tr><td>csf --lfd</td><td>với tham số [stop|start|restart|status] để điều khiện, chạy, dừng dịch vụ lfd. Dịch vụ này giám sát quá trình đăng nhập (kiểm tra xem nó có đang hoạt động csf --lfd status)</td></tr><tr><td>csf -a</td><td>Cho phép một IP truy cập, nó thêm vào danh sách /etc/csf/csf.allow, các IP liệt kê trong danh sách này mặc định được qua Firewall, tuy nhiên nó vẫn bị LFD kiểm tra. Ví dụ thêm IP 123.123.123.123 vào thì gõ <strong>csf -a 123.123.123.123</strong></td></tr><tr><td>csf -d</td><td>Cấm một IP truy cập, nó thêm vào danh sách /etc/csf/csf.deny, ví dụ <strong>csf -d 123.123.123.123</strong></td></tr><tr><td>csf -df</td><td>Gỡ một IP ra khỏi danh sách chặn <strong>csf -df 123.123.123.123</strong></td></tr><tr><td>csf -t</td><td>hiện thị danh sách ip cho phép và bị chặn tạm thời (ip tự ra khỏi danh sách sau một khoảng thời gian)</td></tr><tr><td>csf -x</td><td>Tắt hoàn toàn csf và lfd</td></tr><tr><td>csf -e</td><td>Kích hoạt lại csf và lfd</td></tr></tbody></table></figure><p></p><p></p><p>Một số thiết lập CSF, LFD</p><p></p><p></p><p>Nói chung tất cả cấu hình CSF, các luật firewall đều thiết lập, chỉnh sửa từ các file trong thư mục: <strong>/etc/csf</strong>. Sau khi chỉnh các thiết lập trong những file này cần khởi động lại để có hiệu lực bằng lệnh</p><p></p><p></p><p># csf -r &amp;&amp; csf --lfd restart</p><p></p><p></p><p>Nếu chưa có nano thì có thể cài vào để mở sửa các file config cho tiện</p><p></p><p></p><p># yum install nano -y</p><p></p><p></p><p>Mở file config ra để sửa đổi một số tính năng dưới</p><p></p><p></p><p># nano /etc/csf/csf.conf</p><p></p><p></p><p>1) Bảo vệ khỏi tấn công DOS bằng cách giới hạn số lượng truy cập tới cổng</p><p></p><p></p><p>Cấu hinh tại CONNLIMIT="" với giá trị gán là "port1;limit1,port2,limit2 ..."</p><p></p><p></p><p>Ví dụ:</p><p></p><p></p><p>CONNLIMIT = "22;5,80;20"</p><p></p><p></p><p>Có nghĩa là cổng 80 (http) cho phép 20 kết nối với 1 IP =&gt; Như vậy từ một máy tạo ra truy vấn liên tục tới server tạo ra quá 20 kết nối sẽ bị block, cổng 22 (ssh) là 5 kết nối 1 IP</p><p></p><p></p><p>Có thể đặt</p><p></p><p></p><p>CONNLIMIT = "80;200,443;200"</p><p></p><p></p><p>2) Phòng chống Port Flood</p><p></p><p></p><p>Giám sát tổng số lượng kết nối từ một IP tới một cổng trong một khoảng thời gian chỉ ra với thiết lập PORTFLOOD. Giá trị gán vào có dạng</p><p></p><p></p><p>PORTFLOOD = "cổng;giao thức;tổng kết nối;khoảng thời gian, ..."</p><p></p><p></p><p>Ví dụ:</p><p></p><p></p><p> PORTFLOOD = "80;tcp;100;5"</p><p></p><p></p><p>Có nghĩa là 1 IP nào đó kết nối tới cổng 80 bằng giao thức tcp, trong vòng 5s mà tạo ra tới 100 kết nối thì bị block</p><p></p><p></p><p>3) Phòng chống SYN FLOOD</p><p></p><p></p><p>SYNFLOOD = "1"<br>SYNFLOOD_RATE = "75/s"<br>SYNFLOOD_BURST = "25"</p><p></p><p></p><p>Trong đó SYNFLOOD = "1" để kích hoạt SYN FLOOD. SYNFLOOD_RATE thiết lập số gói SYN gửi tới từ 1 IP /1s. Số lần mà một IP có thể chạm tới SYNFLOOD_RATE trước khi bị block.</p><p></p><p></p><p>4) Mở cổng, đóng cổng</p><p></p><p></p><p>#Các công mở cho phép nhận gói tin từ bên ngoài (IP4)<br>TCP_IN = "20,21,22,25,53,80"<br>#Các công mở cho phép gửi gói tin ra ngoài (IP4)<br>TCP_OUT = "443,20,21,22,25,80"<br>#Tương tự nếu có dùng IP6<br>TCP6_IN = "20,21,22,25"<br>TCP6_OUT = "20,21,22,25"</p><p></p><p></p><p>* Các cổng mà các dịch vụ trên server sử dụng:</p><p></p><p></p><ul><li>Port 20: FTP data transfer</li><li>Port 21: FTP</li><li>Port 22: SSH</li><li>Port 25: SMTP</li><li>Port 53: DNS</li><li>Port 80: HTTP</li><li>Port 110: POP3</li><li>Port 113: Authentication service/identification protocol</li><li>Port 143: IMAP</li><li>Port 443: SSL/TLS (HTTPS)</li></ul><p></p><p></p><p>5) Server quá tải ?</p><p></p><p></p><p>CSF mặc định có kiểm tra mức độ hoạt động của CPU xem nó có bị quá tải hay không. Nếu có sự kiện đó xảy ra thì một email sẽ được gửi đi, trong nhiều trường hợp quá tải dẫn tới Server bị treo. Bạn có thể thiết lập khi quá tải CPU như vậy sẽ chạy script bạn tạo ra để làm một số việc bạn thiết lập ví dụ như khởi động lại Apache</p><p></p><p></p><p>Giả sử bạn tạo ra một script để khởi động lại Apache, lưu tại /restartapache.sh, nhớ chmod cho nó chạy được chmod +x /restartapache.sh</p><p></p><p></p><p>Nội dung của script đó chỉ là lệnh khởi động lại Apache</p><p></p><p></p><p>#!/bin/sh<br>service httpd restart &gt;&gt; overload.log</p><p></p><p></p><p>Bây giờ muốn mỗi khi CPU quá tải sẽ chạy script /restartapache.sh thì sửa config:</p><p></p><p></p><p>#!/bin/sh<br>PT_LOAD_ACTION="/restartapache.sh"</p><p></p><p></p><p>6) Cấm tất cả các IP đến từ một quốc gia nào đó</p><p></p><p></p><p>Tìm đến dòng CC_DENY và điền mã quốc gia cần cấm. Ví dụ chặn IP đến từ Nga và TQ</p><p></p><p></p><p>CC_DENY = "RU,CN"</p><p></p><p></p><p>7)Email thông báo</p><p></p><p></p><p>Các sự kiện do CSF xử lý, bắt được sẽ được gửi tới một email</p><p></p><p></p><p>LF_ALERT_TO = "server@yourdomain.com"</p><p></p><p></p><p>LF_SSH_EMAIL_ALERT = "0"</p><p></p><p></p><p>LF_EMAIL_ALERT = 0</p><p></p><p></p><p> LF_TEMP_EMAIL_ALERT = "0"</p><p></p><p></p><p>Không gửi email thông báo khi có một ai đó login thành công thông qua SSH</p><p></p><p></p><p>8) Block nếu đăng nhập các dịch vụ thất bại</p><p></p><p></p><p>#KÍCH HOẠT GIÁM SÁT LOGIN<br>LF_TRIGGER = "1"</p><p></p><p></p><p>#Block nếu đăng nhập ssh sai 3 lần<br>LF_SSHD = "3"<br>LF_SSHD_PERM = "1"</p><p></p><p></p><p>#Block nếu đăng nhập ftp sai 3 lần<br>LF_FTPD = "3"<br>LF_FTPD_PERM = "1"</p><p></p><p></p><p>Còn một số dịch vụ nữa xem thêm ngay sau các thiết lập này</p><p></p><p></p><p>9) Block danh sách IP SPAM</p><p></p><p></p><p>CSF cung cấp khóa cả danh sách IP, bằng cách đưa URL của danh sách đó vào file /etc/csf/csf.blocklists. Bạn có thể mở file đó ra thêm các danh sách IP mà các dịch vụ phát hiện IP SPAM sau cung cấp:</p><p></p><p></p><p># Spamhaus Don't Route Or Peer List (DROP)<br># Details: <a href="http://www.spamhaus.org/drop/">http://www.spamhaus.org/drop/</a><br>SPAMDROP|86400|0|http://www.spamhaus.org/drop/drop.lasso</p><p></p><p></p><p># Spamhaus Extended DROP List (EDROP)<br># Details: <a href="http://www.spamhaus.org/drop/">http://www.spamhaus.org/drop/</a><br>SPAMEDROP|86400|0|http://www.spamhaus.org/drop/edrop.lasso</p><p></p><p></p><p># DShield.org Recommended Block List<br># Details: <a href="http://dshield.org">http://dshield.org</a><br>DSHIELD|86400|0|http://www.dshield.org/block.txt</p><p></p><p></p><p># TOR Exit Nodes List<br># Set URLGET in csf.conf to use LWP as this list uses an SSL connection<br># Details: <a href="https://trac.torproject.org/projects/tor/wiki/doc/TorDNSExitList">https://trac.torproject.org/projects/tor/wiki/doc/TorDNSExitList</a><br>TOR|3600|0|https://check.torproject.org/cgi-bin/TorBulkExitList.py?ip=1.2.3.4</p><p></p><p></p><p># Alternative TOR Exit Nodes List<br># Details: <a href="http://torstatus.blutmagie.de/">http://torstatus.blutmagie.de/</a><br>ALTTOR|86400|0|http://torstatus.blutmagie.de/ip_list_exit.php/Tor_ip_list_EXIT.csv</p><p></p><p></p><p># BOGON list<br># Details: <a href="http://www.team-cymru.org/Services/Bogons/">http://www.team-cymru.org/Services/Bogons/</a><br>BOGON|86400|0|http://www.cymru.com/Documents/bogon-bn-agg.txt</p><p></p><p></p><p># Project Honey Pot Directory of Dictionary Attacker IPs<br># Details: <a href="http://www.projecthoneypot.org">http://www.projecthoneypot.org</a><br>HONEYPOT|86400|0|http://www.projecthoneypot.org/list_of_ips.php?t=d&amp;rss=1</p><p></p><p></p><p># C.I. Army Malicious IP List<br># Details: <a href="http://www.ciarmy.com">http://www.ciarmy.com</a><br>CIARMY|86400|0|http://www.ciarmy.com/list/ci-badguys.txt</p><p></p><p></p><p># BruteForceBlocker IP List<br># Details: <a href="http://danger.rulez.sk/index.php/bruteforceblocker/">http://danger.rulez.sk/index.php/bruteforceblocker/</a><br>BFB|86400|0|http://danger.rulez.sk/projects/bruteforceblocker/blist.php</p><p></p><p></p><p># OpenBL.org 30 day List<br># Set URLGET in csf.conf to use LWP as this list uses an SSL connection<br># Details: <a href="https://www.openbl.org">https://www.openbl.org</a><br>OPENBL|86400|0|https://www.openbl.org/lists/base_30days.txt</p><p></p><p></p><p># Autoshun Shun List<br># Details: <a href="http://www.autoshun.org/">http://www.autoshun.org/</a><br>AUTOSHUN|86400|0|http://www.autoshun.org/files/shunlist.csv</p><p></p><p></p><p># MaxMind GeoIP Anonymous Proxies<br># Set URLGET in csf.conf to use LWP as this list uses an SSL connection<br># Details: <a href="https://www.maxmind.com/en/anonymous_proxies">https://www.maxmind.com/en/anonymous_proxies</a><br>MAXMIND|86400|0|https://www.maxmind.com/en/anonymous_proxies</p><p></p><p></p><p># Blocklist.de<br># Set URLGET in csf.conf to use LWP as this list uses an SSL connection<br># Details: <a href="https://www.blocklist.de">https://www.blocklist.de</a><br># This first list only retrieves the IP addresses added in the last hour<br>#BDE|3600|0|https://api.blocklist.de/getlast.php?time=3600<br># This second list retrieves all the IP addresses added in the last 48 hours<br># and is usually a very large list (over 10000 entries), so be sure that you<br># have the resources available to use it<br>BDEALL|86400|0|http://lists.blocklist.de/lists/all.txt</p><p></p><p></p><p># Stop Forum Spam<br># Details: <a href="http://www.stopforumspam.com/downloads/">http://www.stopforumspam.com/downloads/</a><br># Many of the lists available contain a vast number of IP addresses so special<br># care needs to be made when selecting from their lists<br>STOPFORUMSPAM|86400|0|http://www.stopforumspam.com/downloads/listed_ip_1.zip</p><p></p><p></p><p>######################################################</p><p></p><p></p><p>Hướng dẫn cấu hình CSF (ConfigServer &amp; Firewall)</p><p></p><p></p><p>- File cấu hình nằm ở /etc/csf/csf.conf , các file còn lại được nhắc đến bên dưới nếu không nêu rõ đường dẫn thì đều nằm ở thư mục /etc/csf/</p><p></p><p></p><p>- Các tham số khi cấu hình có dạng ARGS = "VALUE" , trong đó</p><p></p><p></p><p>+ VALUE = "0" =&gt; Disable</p><p></p><p></p><p>+ VALUE = "1" =&gt; Enable</p><p></p><p></p><p>+ VALUE &gt; 1 (VALUE = "20" , VALUE = "30" ... ) : giới hạn tối đa.</p><p></p><p></p><p>+ VALUE &gt;1 (VALUE = "1800" , VALUE = "3600" ... ) : thời gian tối đa.</p><p></p><p></p><p>Bắt đầu:</p><p></p><p></p><p>TESTING = "0"</p><p></p><p></p><p>Mặc định khi vừa cài TESTING = "1", với TESTING = "1" thì LFD daemon (Login Fail Detect daemon) sẽ không hoạt động, do đó nếu có gì sai sót thì server cũng sẽ không block IP của bạn. Khi cảm thấy cấu hình đã ổn thì tắt TESTING để LFD bắt đầu hoạt động và chặn các IP tấn công.</p><p></p><p></p><p>TESTING_INTERVAL = "5"</p><p></p><p></p><p>Thời gian chạy cronjob để clear iptables nếu như TESTING=1 , tính bằng phút.</p><p></p><p></p><p>AUTO_UPDATES = "0"</p><p></p><p></p><p>Disable auto update</p><p></p><p></p><p>TCP_IN = "22,25,53,80,443"</p><p></p><p></p><p>Allow incoming TCP ports: cho ngừoi dùng kết nối đến các dịch vụ SSH, sendmail, DNS, Web trên server.</p><p></p><p></p><p>TCP_OUT = "25,80"</p><p></p><p></p><p>Allow outgoing TCP port: cho phép server kết nối đến web server, sendmail server khác.</p><p></p><p></p><p>UDP_IN = "53"</p><p></p><p></p><p>Allow incoming UDP ports: cho phép người dùng sử dụng dịch vụ DNS trên server.</p><p></p><p></p><p>UDP_OUT = "53"</p><p></p><p></p><p>Allow outgoing UDP ports: cho phép server truy vấn DNS bên ngoài.</p><p></p><p></p><p>ICMP_IN = "1"</p><p></p><p></p><p>Cho phép ping đến server.</p><p></p><p></p><p>ICMP_IN_RATE = "1/s"</p><p></p><p></p><p>Giới hạn tần số ping đến server là 1/s. Nếu ping nhanh hơn tốc độ này sẽ nhận được "Request timeout" . Trong trường hợp nếu nhiều người cùng ping đến server cùng lúc , thì phần lớn sẽ nhận được các phản hồi "Request timeout" do server chỉ nhận 1 request/s , điều này làm chúng ta lầm tưởng kết nối mạng có vấn đề , mạng bị chập chờn nhưng thật ra không phải như vậy . Chỉ cần nâng thông số này lên cao một chút hoặc bỏ luôn ( set giá trị = 0 ) sẽ khắc phục được tình trạng trên.</p><p></p><p></p><p>ETH_DEVICE = "eth0"</p><p></p><p></p><p>Mặc định csf sẽ cấu hình iptables để filter traffic trên toàn bộ các card mạng , ngoại trừ card loopback . Nếu như bạn muốn rules iptables chỉ applied vào card mạng "eth0" thì khai báo ở đây.</p><p></p><p></p><p>ETH_DEVICE_SKIP = "eth1"</p><p></p><p></p><p>Nếu bạn không muốn rules iptables không applied vào card mạng nào thì khai báo ở đây. Ví dụ card "eth1" là card local , bạn không muốn filter trên card này thì cấu hình như trên.</p><p></p><p></p><p>DENY_IP_LIMIT = "500</p><p></p><p></p><p>"</p><p></p><p></p><p>Giới hạn số lượng IP bị block "vĩnh viễn" bởi CSF (các IP này được lưu trong file /etc/csf/csf.deny). Con số này tùy thuộc vào resource của mỗi server, nếu dùng VPS thì con số này vào khoảng "200" là hợp lý , còn dedicated server thì khoảng "500". Khi số lượng IP bị block vượt qua con số này , csf sẽ tự động unblock IP cũ nhất (IP ở dòng 1 của file /etc/csf/csf.deny)</p><p></p><p></p><p>LF_DAEMON = "1"</p><p></p><p></p><p>Enable tính năng Login fail detection.</p><p></p><p></p><p>LF_CSF = "1"</p><p></p><p></p><p>Tự động restart CSF khi csf bị stop.</p><p></p><p></p><p>PACKET_FILTER = "1"</p><p></p><p></p><p>Filter các gói tin TCP không hợp lệ (INVALID state như : sequence number không đúng , kết nối ko được thực hiện đủ qua 3 bước bắt tay ... )</p><p></p><p></p><p>IPV6 = "0"</p><p></p><p></p><p>Disable IPV6 support</p><p></p><p></p><p>SYNFLOOD = "1"SYNFLOOD_RATE = "30/s"SYNFLOOD_BURST = "40"</p><p></p><p></p><p>Enable synflood protection : Nếu 1 IP gửi 30 cú SYN trong vòng 1s và số lượng SYN connection tồn tại trên server đạt trên 40 thì block IP đó (temp block)</p><p></p><p></p><p>CONNLIMIT = "80;20"</p><p></p><p></p><p>Giới hạn số lượng new concurrent connection đến server trên mỗi IP. Ví dụ trên có nghĩa : mỗi IP được phép mở 20 concurrent new connection đến port 80 trên server.</p><p></p><p></p><p>PORTFLOOD = "80;tcp;20;5"</p><p></p><p></p><p>Giới hạn số lượng connection đến một port cụ thể trong một khoảng thời gian nhất định. Ví dụ như trên có nghĩa : nếu nhiều hơn 20 kết nối tcp đến port 80 trong vòng 5s thì block IP đó tối thiểu 5s tính từ packet cuối cùng của IP đó. Sau 5s IP đó sẽ tự động được unlock và truy cập bình thường.</p><p></p><p></p><p>DROP_NOLOG = "10050,10051"</p><p></p><p></p><p>Danh sách các port khi bị drop sẽ không cần phải ghi vào log</p><p></p><p></p><p>CONNLIMIT_LOGGING = "1"</p><p></p><p></p><p>Ghi log các IP vượt quá giới hạn CONNLIMIT cấu hình ở bước trên.</p><p></p><p></p><p>LF_ALERT_TO = "your_email@your_domain.com"</p><p></p><p></p><p>Mặc định toàn bộ email thông báo sẽ được gửi về root của server . Nếu bạn muốn gửi đến địa chỉ email khác thì khai báo ở đây.</p><p></p><p></p><p>LF_PERMBLOCK = "1"LF_PERMBLOCK_INTERVAL = "86400"LF_PERMBLOCK_COUNT = "6"LF_PERMBLOCK_ALERT = "1"</p><p></p><p></p><p>Enable tính năng block vĩnh viễn một IP . Nếu một IP bị temp ban (ban tạm) 6 lần khi vi phạm các rule sẽ block ip này 86400s ( 1 ngày) đồng thời gửi email về cho ngừoi quản trị biết.</p><p></p><p></p><p>LF_TRIGGER = "1"</p><p></p><p></p><p>Enable tính năng Login Fail Detect cho từng dịch vụ cụ thể (được khai báo bên dưới)</p><p></p><p></p><p>LF_TRIGGER_PERM = "1"</p><p></p><p></p><p>Khi LF_TRIGGER = "1" thì có thể enable LF_TRIGGER_PERM để kích hoạt block IP permanent</p><p></p><p></p><p>+ LF_TRIGGER_PERM = "1" =&gt; IP sẽ bị block permanent</p><p></p><p></p><p>+ LF_TRIGGER_PERM = "86400" =&gt; IP sẽ bị block 1 ngày</p><p></p><p></p><p>LF_SELECT = "1"</p><p></p><p></p><p>Khi một IP vi phạm các rule của LFD thay vì block toàn bộ traffic từ IP này đến server thì chỉ block traffic đến dịch vụ mà IP này login fail (ví dụ login ftp sai nhiều lần thì block truy cập đến FTP nhưng vẫn cho phép truy cập vào website)</p><p></p><p></p><p>LF_EMAIL_ALERT = "1"</p><p></p><p></p><p>Gửi email thông báo nếu một IP bị block bởi các trigger bên dưới</p><p></p><p></p><p>LF_SSHD = "5"LF_SSHD_PERM = "1"</p><p></p><p></p><p>Nếu login SSH sai 5 lần thì sẽ bị block IP (temp block)</p><p></p><p></p><p>Nếu bị temp block lớn hơn số lần quy định ở LF_PERMBLOCK_COUNT (cấu hình bước trên ) thì sẽ block permanent.</p><p></p><p></p><p>LF_FTPD = "0"LF_FTPD_PERM = "1"</p><p></p><p></p><p>Không kích hoạt login fail detect cho dịch vụ FTP.</p><p></p><p></p><p>Tương tự cho các dịch vụ còn lại bên dưới ( SMTP , POP3 , IMAP , .htpasswd , mod_security ... )</p><p></p><p></p><p>LF_SSH_EMAIL_ALERT = "0"</p><p></p><p></p><p>LF_EMAIL_ALERT = 0</p><p></p><p></p><p> LF_TEMP_EMAIL_ALERT = "0"</p><p></p><p></p><p>Không gửi email thông báo khi có một ai đó login thành công thông qua SSH</p><p></p><p></p><p>LF_SU_EMAIL_ALERT = "0"</p><p></p><p></p><p>Không gửi email thông báo khi có một người dùng "su" (switch user) qua người dùng khác. Không gửi email khi họ dùng lệnh "su" , bất kể "su" thành công hoặc thất bại.</p><p></p><p></p><p>LF_DIRWATCH = "3600"</p><p></p><p></p><p class="has-drop-cap">LFD sẽ check thư mục /tmp và /dev/shm định kỳ sau mỗi 3600s , nếu phát hiện ra các file nghi vấn là file độc hại sẽ gửi email thông báo đến cho chúng ta. Thường thì trên server thư mục, /temp và /dev/shm phân quyền cho phép mọi người dùng có quyền ghi trên thư mục này , do đó các attacker lợi dụng điều này để ghi mã độc vào đây (các file để back connect , local root exploit ... )</p><p></p></div><footer><div class="post__tags-share"><aside class="post__share"></aside></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="https://ddtrungit.github.io/how-to-fix-centos-6-end-of-line-error-yumrepo-error-all-mirror-urls-are-not-using-ftp-https-or-file/index.html" rel="prev">Previous Post<h3 class="h6">HOW TO FIX CENTOS 6 End of Line ERROR: YUMREPO ERROR: ALL MIRROR URLS ARE NOT USING FTP, HTTP[S] OR FILE</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="https://ddtrungit.github.io/csf-and-zimbra-mail/index.html" rel="prev">Next Post<h3 class="h6">Csf and Zimbra mail</h3></a></div></nav></footer></div></article><div class="comments-area post__inner" id="comments"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div class="fb-comments" data-href="https://ddtrungit.github.io/csf-cai-dat-cau-hinh-firewall-cho-server/" data-width="100%" data-colorscheme="light" data-lazy="true" data-order-by="reverse_time" data-numposts="5"></div><noscript>Please enable JS to use the comments form.</noscript></div></div><div id="fb-root"></div><script type="text/javascript" async defer="defer" crossorigin="anonymous" src="https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v12.0">nonce="n4mWU9e7"</script></div></div><div class="post__related"><div class="wrapper"><h2 class="h5">Related posts</h2><div class="l-grid l-grid--4"><article class="c-card"><a href="https://ddtrungit.github.io/install-and-configure-openvpn-server-on-ubuntu-linux/index.html" class="c-card__image"><img src="https://ddtrungit.github.io/media/posts/108/what_is_openvpn_thumb800.jpg" srcset="https://ddtrungit.github.io/media/posts/108/responsive/what_is_openvpn_thumb800-xs.jpg 300w, https://ddtrungit.github.io/media/posts/108/responsive/what_is_openvpn_thumb800-sm.jpg 480w, https://ddtrungit.github.io/media/posts/108/responsive/what_is_openvpn_thumb800-md.jpg 768w, https://ddtrungit.github.io/media/posts/108/responsive/what_is_openvpn_thumb800-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="450" width="800" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://ddtrungit.github.io/tags/linux/index.html">Linux</a></div><h3 class="c-card__title"><a href="https://ddtrungit.github.io/install-and-configure-openvpn-server-on-ubuntu-linux/index.html" class="invert">Install and Configure OpenVPN Server on Ubuntu Linux</a></h3></header><p class="c-card__text">Download openvpn-install.sh script to set up OpenVPN server in 5 minutes on Ubuntu Type the following wget command or curl&hellip;</p><footer class="c-card__meta"><div class="c-card__comments"><a href="https://ddtrungit.github.io/install-and-configure-openvpn-server-on-ubuntu-linux/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://ddtrungit.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article><article class="c-card"><a href="https://ddtrungit.github.io/tuned-automatic-performance-tuning-of-centosrhel-servers/index.html" class="c-card__image"><img src="https://ddtrungit.github.io/media/posts/101/centos-la-gi.jpg" srcset="https://ddtrungit.github.io/media/posts/101/responsive/centos-la-gi-xs.jpg 300w, https://ddtrungit.github.io/media/posts/101/responsive/centos-la-gi-sm.jpg 480w, https://ddtrungit.github.io/media/posts/101/responsive/centos-la-gi-md.jpg 768w, https://ddtrungit.github.io/media/posts/101/responsive/centos-la-gi-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="276" width="540" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://ddtrungit.github.io/tags/tip/index.html">Tip</a></div><h3 class="c-card__title"><a href="https://ddtrungit.github.io/tuned-automatic-performance-tuning-of-centosrhel-servers/index.html" class="invert">Tuned – Automatic Performance Tuning of CentOS/RHEL Servers</a></h3></header><p class="c-card__text">https://github.com/redhat-performance/tuned service tuned status tuned-adm active tuned-adm profile network-latency latency-performance Centos6: wget http://centos-hn.viettelidc.com.vn/6.10/os/x86_64/Packages/tuned-0.2.19-18.el6.noarch.rpm Tuned is a powerful daemon for dynamically auto-tuning&hellip;</p><footer class="c-card__meta"><div class="c-card__comments"><a href="https://ddtrungit.github.io/tuned-automatic-performance-tuning-of-centosrhel-servers/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://ddtrungit.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article><article class="c-card"><a href="https://ddtrungit.github.io/gioi-thieu-ve-lamp-lemp-reverse-proxy-mo-hinh-he-thong-web/index.html" class="c-card__image"><img src="https://ddtrungit.github.io/media/posts/90/1_dOxtTxv17_uuQIRVLm5FEQ.jpeg" srcset="https://ddtrungit.github.io/media/posts/90/responsive/1_dOxtTxv17_uuQIRVLm5FEQ-xs.jpeg 300w, https://ddtrungit.github.io/media/posts/90/responsive/1_dOxtTxv17_uuQIRVLm5FEQ-sm.jpeg 480w, https://ddtrungit.github.io/media/posts/90/responsive/1_dOxtTxv17_uuQIRVLm5FEQ-md.jpeg 768w, https://ddtrungit.github.io/media/posts/90/responsive/1_dOxtTxv17_uuQIRVLm5FEQ-lg.jpeg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="1080" width="1920" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://ddtrungit.github.io/tags/linux/index.html">Linux</a></div><h3 class="c-card__title"><a href="https://ddtrungit.github.io/gioi-thieu-ve-lamp-lemp-reverse-proxy-mo-hinh-he-thong-web/index.html" class="invert">Giới thiệu về LAMP, LEMP, Reverse Proxy – Mô hình hệ thống Web</a></h3></header><p class="c-card__text">Mô hình đơn giản của một hệ thống web bao gồm: Trong đó: Một request duyệt web thông thường sẽ&hellip;</p><footer class="c-card__meta"><div class="c-card__comments"><a href="https://ddtrungit.github.io/gioi-thieu-ve-lamp-lemp-reverse-proxy-mo-hinh-he-thong-web/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://ddtrungit.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article><article class="c-card"><a href="https://ddtrungit.github.io/linux-server-performance-tips/index.html" class="c-card__image"><img src="https://ddtrungit.github.io/media/posts/77/selecting-the-best-linux-dedicated-server.png" srcset="https://ddtrungit.github.io/media/posts/77/responsive/selecting-the-best-linux-dedicated-server-xs.png 300w, https://ddtrungit.github.io/media/posts/77/responsive/selecting-the-best-linux-dedicated-server-sm.png 480w, https://ddtrungit.github.io/media/posts/77/responsive/selecting-the-best-linux-dedicated-server-md.png 768w, https://ddtrungit.github.io/media/posts/77/responsive/selecting-the-best-linux-dedicated-server-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="407" width="809" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://ddtrungit.github.io/tags/tip/index.html">Tip</a></div><h3 class="c-card__title"><a href="https://ddtrungit.github.io/linux-server-performance-tips/index.html" class="invert">Linux Server Performance Tips</a></h3></header><p class="c-card__text">Network – Improving Performance Những thông số dưới đây nhằm tối ưu kết nối mạng trên các hệ điều hành&hellip;</p><footer class="c-card__meta"><div class="c-card__comments"><a href="https://ddtrungit.github.io/linux-server-performance-tips/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="https://ddtrungit.github.io/assets/svg/svg-map.svg#comments"/></svg></a></div></footer></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://facebook.com/duongtrung2103" aria-label="Facebook" class="facebook"><svg><use xlink:href="https://ddtrungit.github.io/assets/svg/svg-map.svg#facebook"/></svg></a></div><div class="footer__copyright">"DO THE THINGS YOU LOVE!"</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://ddtrungit.github.io/assets/js/scripts.min.js?v=d78591855e0ce96bf51239b499260e20"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>
<!doctype html><html amp lang="vi"><head><meta charset="utf-8"><title>TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO? - TRUNG DUONG</title><link rel="canonical" href="https://ddtrungit.github.io/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet" type="text/css"><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script><script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ddtrungit.github.io/amp/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html"},"headline":"TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO?","datePublished":"2021-01-28T04:02","dateModified":"2022-06-13T14:30","image":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/posts/85/best-ways-to-speed-up-wp-site.jpg","height":1080,"width":1920},"description":"Tuy nhiên, mỗi website sẽ có 1 đặc điểm riêng, không phải site nào tối ưu cũng giống site nào,&hellip;","author":{"@type":"Person","name":"Duong Dinh Trung","url":"https://ddtrungit.github.io/amp/authors/dtrungit/"},"publisher":{"@type":"Organization","name":"Duong Dinh Trung","logo":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/website/Background_noBg.png","height":1200,"width":1600}}}</script><style amp-custom>article,
aside,
footer,
header,
hgroup,
main,
nav,
section {
  display: block; }

*,
*:before,
*:after {
  -webkit-box-sizing: content-box;
  box-sizing: content-box;
  margin: 0;
  padding: 0; }

li {
  list-style: none; }

amp-img {
  max-width: 100%; }

button,
input,
select,
textarea {
  font: inherit; }

html {
  font-size: 1rem; }

body {
  background: #f1f1f1;
  color: #262626;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  line-height: 1.6; }

a {
  color:  #039be5;
  text-decoration: none;
  -webkit-transition: all 0.12s linear 0s;
  -o-transition: all 0.12s linear 0s;
  transition: all 0.12s linear 0s; }

a:hover {
  color: #262626;
  text-decoration: underline;
  -webkit-text-decoration-skip: ink;
  text-decoration-skip: ink; }

a:active {
  color: #262626; }

a:focus {
  outline: 2px dotted #039be5; }

figure,
blockquote,
p,
ul,
ol,
dl,
table,
hr,
fieldset {
  margin-top: 1.6rem; }

h1,
h2,
h3,
h4,
h5,
h6 {
  color: #262626;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  font-weight: 500;
  line-height: 1.2;
  margin-top: 2.13333rem; }

h1 {
  font-size: 1.67583rem;
  font-weight: normal; }

h2 {
  font-size: 1.4729rem; }

h3 {
  font-size: 1.29454rem; }

h4 {
  font-size: 1.13778rem; }

h5 {
  font-size: 1rem; }

h6 {
  font-size: 0.87891rem; }

h2 + p,
h3 + p,
h4 + p,
h5 + p,
h6 + p {
  margin-top: 0.8rem; }

b,
strong {
  font-weight: 600; }

blockquote {
  color: #6c7175;
  font-family: "Droid Serif", "Times", "Source Serif Pro", serif;
  font-style: italic;
  padding: 1.33333rem 0.53333rem 1.33333rem 3.2rem;
  position: relative; }
  blockquote:before {
    display: block;
    content: "\201C";
    font-size: 4.41226rem;
    position: absolute;
    left: 0;
    top: -12px;
    color: rgba(108, 113, 117, 0.5); }
  blockquote > :nth-child(1) {
    margin-top: 0; }

ul,
ol {
  margin-left: 2rem; }
  ul > li,
  ol > li {
    list-style: inherit;
    padding: 0 0 0.26667rem 0.26667rem; }

dl dt {
  color: #262626;
  font-weight: 600; }

code,
pre {
  background-color: #f1f1f1;
  font-family: monospace; }

pre {
  margin: 1.6rem 0 0;
  padding: 1.6rem;
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow-x: auto; }
  pre > code {
    color: #262626;
    padding: 0; }

code {
  border-radius: 3px;
  color: #262626;
  padding: 0.26667rem 0.53333rem; }

table {
  border-collapse: collapse;
  border-spacing: 0;
  border: 1px solid #d4d4d4;
  width: 100%;
  overflow-x: auto;
  vertical-align: top;
  text-align: left;
  white-space: nowrap; }
  table th {
    font-weight: 500;
    padding: 0.53333rem 1.06667rem; }
  table tr {
    border-bottom: 1px solid #d4d4d4; }
    table tr:nth-child(2n) {
      background: #f1f1f1; }
  table td {
    padding: 0.53333rem 1.06667rem; }

figcaption {
  clear: both;
  color: rgba(108, 113, 117, 0.6);
  font-size: 0.82397rem;
  margin: 0.8rem 0 0;
  text-align: center; }

sub,
sup {
  font-size: 65%; }

hr {
  border: 0;
  height: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(255, 255, 255, 0.3); }

.btn, [type=button],
[type=submit],
button {
  background: #039be5;
  border: none;
  border-radius: 2px;
  color: #ffffff;
  cursor: pointer;
  display: inline-block;
  font-size: 0.87891rem;
  font-weight: 500;
  line-height: 1.9;
  padding: 0.53333rem 1.33333rem;
  text-align: center;
  text-decoration: none;
  -webkit-transition: all .15s ease;
  -o-transition: all .15s ease;
  transition: all .15s ease;
  width: auto; }
  .btn:hover, [type=button]:hover,
  [type=submit]:hover,
  button:hover {
    background: #262626;
    color: #ffffff; }
  .btn:focus, [type=button]:focus,
  [type=submit]:focus,
  button:focus {
    outline: none; }
  .btn-outline {
    border: 1px solid #ddd;
    background: #ffffff;
    border-radius: 3px;
    color: #262626; }

[type=button],
[type=submit],
button {
  text-transform: uppercase;
  -webkit-appearance: none;
  -moz-appearance: none; }

.navbar {
  background: #039be5;
  -webkit-box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.2);
  box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.2);
  line-height: 3;
  max-height: 4rem; }
  .navbar > div {
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    text-align: left;
    max-width: 700px;
    margin: 0 auto; }
  .navbar a {
    color: #ffffff;
    text-decoration: none; }
  .navbar-sidebar-toggle {
    left: 0;
    position: relative;
    text-indent: -99999rem; }
    .navbar-sidebar-toggle:before {
      content: "";
      display: block;
      border-top: 0.375rem double #ffffff;
      border-bottom: 0.125rem solid #ffffff;
      height: 0.125rem;
      position: absolute;
      text-indent: 0;
      top: 50%;
      width: 1.3rem;
      -webkit-transform: translate(0px, -50%);
      -ms-transform: translate(0px, -50%);
      transform: translate(0px, -50%); }


.logo {
            background-image: url('https://ddtrungit.github.io/media/website/Background_noBg.png');
            background-size: auto 2rem;
            background-repeat: no-repeat;
            background-position: center center;
            display: inline-block;
  font-weight: 600;
  line-height: 1;
            margin: 0 auto;
            height: 2rem;
            text-indent: -9999px;
            width: 240px;vertical-align: middle;
        }
        .logo.logo-text {
            line-height: 2;
            text-align: center;
            text-indent: 0;
        }

amp-sidebar {
  background: #ffffff;
  width: 240px; }
  amp-sidebar > ul {
    margin: 0.8rem 0 0;
    padding: 0; }
    amp-sidebar > ul ul {
      border-left: 1px solid #d4d4d4;
      margin: 0.53333rem 0 0; }
    amp-sidebar > ul li {
      color: #262626;
      font-size: 0.9375rem;
      font-weight: 600;
      list-style: none;
      line-height: 1.4;
      padding: 0.42667rem 1.06667rem; }
      amp-sidebar > ul li li {
        font-weight: normal;
        padding: 0.26667rem 0 0.26667rem 1.06667rem; }
    amp-sidebar > ul a,
    amp-sidebar > ul a:visited {
      color: #262626; }

.bg-white {
  background: #ffffff; }

.wrap-page {
  max-width: 700px;
  margin: 0 auto; }

@media all and (max-width: 43.6875em) {
  .wrap-inner {
    padding: 0 6%; } }

.page-title {
  background: #ffffff;
  -webkit-box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  margin-bottom: 0.8rem;
  padding: 1.6rem 6%; }
  .page-title > h1 {
    margin: 0;
    font-size: 1.29454rem; }
  .page-title > p {
    font-size: 0.87891rem;
    color: #6c7175;
    line-height: 1.3;
    margin: 0.26667rem 0 0; }
  .page-title-author {
    border-radius: 50%;
    float: left;
    height: 2.5rem;
    width: 2.5rem; }
    .page-title-author + h1 {
      margin-left: 3.5rem; }
      .page-title-author + h1 + p {
        margin-left: 3.5rem; }

.card {
  background: #ffffff;
  -webkit-box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  margin-bottom: 0.8rem;
  padding-bottom: 1.06667rem; }

  .card-meta {
    border-top: 1px solid #d4d4d4;
    color: rgba(108, 113, 117, 0.6);
    font-size: 0.7242rem;
    font-weight: 500;
    margin-top: 1.06667rem;
    padding-top: 1.06667rem;
    text-transform: uppercase; }
    .card-meta a + time:before {
      content: "";
      background: #d4d4d4;
      display: inline-block;
      height: 3px;
      margin: 0 8px;
      width: 3px;
      vertical-align: middle;
      border-radius: 50%; }
  .card-text {
    font-size: 0.9375rem;
    overflow: hidden;
    padding: 0 6%; }
    .card-text h2 {
      font-size: 1.13778rem; }

.post {
  margin-bottom: 2.13333rem; }
  .post-featured-image {
    margin-top: 0;
    position: relative; }
    .post-featured-image > figcaption {
      background: rgba(0, 0, 0, 0.5);
      border-radius: 3px;
      color: #ffffff;
      position: absolute;
      bottom: 0.8rem;
      padding: 0 0.26667rem;
      right: 6%; }
  .post-header {
    margin-bottom: 2.13333rem; }
  .post-meta {
    border-bottom: 1px solid #d4d4d4;
    color: rgba(108, 113, 117, 0.6);
    font-size: 0.7242rem;
    font-weight: 500;
    margin-top: 1.06667rem;
    padding-bottom: 1.06667rem;
    text-transform: uppercase; }
    .post-meta a + time:before {
      content: "";
      background: #d4d4d4;
      display: inline-block;
      height: 3px;
      margin: 0 8px;
      width: 3px;
      vertical-align: middle;
      border-radius: 50%; }
  .post-tag {
    margin: 0; }
    .post-tag > li {
      display: inline-block;
      padding: 0; }
      .post-tag > li a {
        background: #f1f1f1;
        border-radius: 2px;
        color: #6c7175;
        font-size: 0.77248rem;
        display: inline-block;
        margin: 0 0.26667rem 0.26667rem 0;
        padding: 0.26667rem 0.53333rem; }
        .post-tag > li a:hover {
          background: #039be5;
          color: #ffffff;
          text-decoration: none; }
  .post-share {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
    -ms-flex-direction: row;
    flex-direction: row;
    -webkit-box-pack: justify;
    -ms-flex-pack: justify;
    justify-content: space-between;
    margin-top: 1.6rem;
    width: 100%; }
    .post-share amp-social-share {
      -webkit-box-flex: 1;
      -ms-flex: 1 0 auto;
      flex: 1 0 auto;
      background-size: 24px; }
  .post-scroll {
    color: #ffffff;
    background: #039be5;
    bottom: 10px;
    border-radius: 50%;
    border: none;
    -webkit-box-shadow: 0 1px 1.5px 0 rgba(38, 38, 38, 0.12), 0 1px 1px 0 rgba(38, 38, 38, 0.24);
    box-shadow: 0 1px 1.5px 0 rgba(38, 38, 38, 0.12), 0 1px 1px 0 rgba(38, 38, 38, 0.24);
    font-size: 1.13778rem;
    height: 46px;
    opacity: 0;
    outline: none;
    position: fixed;
    padding: 0;
    right: 4%;
    visibility: hidden;
    width: 46px;
    z-index: 9999; }
    .post-scroll-marker {
      height: 0px;
      position: absolute;
      top: 100px;
      width: 0px; }
        .post-pagination {
    background: #f1f1f1;
    -webkit-box-shadow: inset 0 2px 3px rgba(38, 38, 38, 0.1);
    box-shadow: inset 0 2px 3px rgba(38, 38, 38, 0.1);
    border-top: 1px solid #d4d4d4;
    padding: 1.06667rem 0; }
    .post-pagination > div {
      line-height: 1.2;
      padding: 0.53333rem 1.06667rem;
      text-align: center; }
      .post-pagination > div span {
        display: block;
        color: #6c7175;
        font-size: 0.7242rem;
        font-weight: 500;
        margin-bottom: 0.26667rem;
        text-transform: uppercase; }
    .post-pagination-prev a:before {
      content: "\2190";
      margin-right: 0.26667rem; }
    .post-pagination-next a:after {
      content: "\2192";
      margin-left: 0.26667rem; }

aside {
  margin: 1.6rem 0 0; }

.align-left {
  text-align: left; }

.align-right {
  text-align: right; }

.align-center {
  text-align: center; }

.align-justify {
  text-align: justify; }

.msg {
  border-left: 2px solid transparent;
  padding: 1.06667rem 1.06667rem; }
  .msg--highlight {
    background-color: #fff8e6;
    border-color: #e2ac4f; }
  .msg--info {
    background: rgba(45, 97, 201, 0.03);
    border-color: #039be5; }
  .msg--success {
    background: #f7fbf6;
    border-color: #5ab44b; }
  .msg--warning {
    background: #fff3f3;
    border-color: #c06367;
    color: #a94442; }

.dropcap:first-letter {
  float: left;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  font-size: 2.16943rem;
  line-height: 0.7;
  margin-right: 0.53333rem;
  padding: 0.53333rem 0.53333rem 0.53333rem 0; }

.pagination {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: justify;
  -ms-flex-pack: justify;
  justify-content: space-between;
  margin: 0.8rem 0; }
  .pagination > a {
    padding-left: 0;
    padding-right: 0;
    width: 49%; }
  .pagination-right {
    margin-left: auto; }

.bottom {
  background: #039be5;
  color: #ffffff;
  padding: 1.06667rem 4%;
  text-align: center; }</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><script async src="https://cdn.ampproject.org/v0.js"></script><script custom-element="amp-animation" src="https://cdn.ampproject.org/v0/amp-animation-0.1.js" async></script><script custom-element="amp-position-observer" src="https://cdn.ampproject.org/v0/amp-position-observer-0.1.js" async></script></head><body class="bg-white"><nav class="navbar wrap-inner" id="top"><div><a on="tap:navbar-sidebar.toggle" class="navbar-sidebar-toggle" title="Menu">Menu</a> <a class="logo" href="https://ddtrungit.github.io/amp/index.html">TRUNG DUONG</a></div></nav><main class="wrap-page"><article class="post"><figure class="post-featured-image"><amp-img src="https://ddtrungit.github.io/media/posts/85/best-ways-to-speed-up-wp-site.jpg" alt="" srcset="https://ddtrungit.github.io/media/posts/85/responsive/best-ways-to-speed-up-wp-site-xs.jpg 300w ,https://ddtrungit.github.io/media/posts/85/responsive/best-ways-to-speed-up-wp-site-sm.jpg 480w ,https://ddtrungit.github.io/media/posts/85/responsive/best-ways-to-speed-up-wp-site-md.jpg 768w ,https://ddtrungit.github.io/media/posts/85/responsive/best-ways-to-speed-up-wp-site-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" height="1080" layout="responsive" width="1920"></amp-img></figure><div class="wrap-inner"><header class="post-header"><h1>TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO?</h1><p class="post-meta">By <a href="https://ddtrungit.github.io/amp/authors/dtrungit/index.html" rel="nofollow" title="Duong Dinh Trung">Duong Dinh Trung</a></p></header><p></p><p>Tuy nhiên, mỗi website sẽ có 1 đặc điểm riêng, không phải site nào tối ưu cũng giống site nào, quan trọng là để các bạn mới nắm được hướng tiếp cận và xác định được các điểm cần phải tập trung cải thiện. Sau một hồi hì hục phân tích và gõ lệnh, kết quả đạt được cũng gọi là chấp nhận được</p><p></p><p></p><p><strong><em>TTFB</em></strong>: <em>Thời gian chờ nhận byte dữ liệu phản hồi đầu tiên từ server, server xử lý càng nhanh thì thời gian chờ càng ít, chứng tỏ càng hiệu quả:</em></p><p></p><p></p><ul><li>Trước khi tối ưu: <strong>648.92ms</strong></li></ul><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-327"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_2.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_2-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_2-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_2-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><ul><li>Sau khi tối ưu: <strong>36.57ms</strong></li></ul><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-328"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_nginx_cache-1024x617.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_nginx_cache-1024x617-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_nginx_cache-1024x617-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_nginx_cache-1024x617-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Tính ra, website đã load nhanh hơn <strong>18 lần</strong> so với ban đầu. OK, giờ ghi chú lại quá trình làm của mình thôi nào!</p><p></p><p></p><p>Trước tiên, muốn giảm độ trễ cần xác định request của mình được xử lý và đi qua những “hop” như thế nào.</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-329"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_architecture.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_architecture-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_architecture-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_architecture-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><ul><li>Khi người dùng truy cập vào trang chủ (GET / ), request này sẽ được gửi lên server qua Internet. Tùy thuộc vào tốc độ kết nối mạng giữa client và server mà độ trễ cao hay thấp. Đây là <strong>điểm delay thứ 1</strong>.</li><li>Khi request đến được server sẽ trải qua nhiều bước để lên đến được tầng application và gặp Web Server. Web server sẽ tiếp nhận và xử lý request, đây là <strong>điểm delay thứ 2</strong>.</li><li>Web server nhận thấy request cần được PHP xử lý nên đẩy vào trong cho PHP + MySQL, đây là <strong>điểm delay thứ 3.</strong></li><li>Sau khi PHP xử lý xong sẽ ra kết quả là 1 cục HTML, ném cục này lại cho Web Server và Web server sẽ ném cục này lại cho Browser. </li><li>Browser nhận được cục HTML sẽ hiển thị lên cho người dùng và đồng thời load tiếp các resource liên quan khác (js, css, image v.v).</li></ul><p></p><p></p><p>Túm lại, sơ bộ đã xác định được 3 điểm cần check, giờ tiến hành khoanh vùng và check từng điểm.</p><p></p><p></p><p><strong>1. Check điểm delay 1:</strong> Tốc độ kết nối giữa mình và máy chủ</p><p></p><p></p><p>Đơn giản và hiệu quả chính là câu lệnh ping thần thánh:</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-330"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_ping.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_ping-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_ping-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_ping-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Okie, ping đẹp, delay chỉ từ 4ms-5ms. Chỗ này ổn, loại ra khỏi danh sách, tập trung vào các khu vực khác.</p><p></p><p></p><p><strong>2. Check điểm delay 2:</strong> Web Server</p><p></p><p></p><p>Ngó sơ tình hình trước cái đã, mở Developer Tools của Browser lên (F12), chọn phần Network và truy cập vào website:</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-331"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_1-1024x632.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_1-1024x632-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_1-1024x632-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_1-1024x632-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Hmm, thời gian xử lý lâu nhất nguyên cây xanh lè đập vào mắt là chỗ xử lý code của trang chủ. Ngó kỹ vào nó chút:</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-332"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_2-1.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_2-1-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_2-1-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_2-1-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Phần lớn thời gian là chờ byte dữ liệu phản hồi đầu tiên (TTFB): 649ms, thời gian download cục HTML về chỉ tốn 2.07ms. Vậy việc cần làm là triệt tiêu bớt thời gian chờ, giúp nhận được cục HTML sớm hơn. Như theo mô hình đã khoanh vùng và loại trừ đoạn delay số 1, lúc này cần tập trung vào đoạn delay số 2 và số 3. Theo kinh nghiệm thì chắc chắn đoạn cần tối ưu là đoạn 3 (PHP + MySQL) , tuy nhiên cứ phải check từng bước đã, đừng để kinh nghiệm nó lừa mình.</p><p></p><p></p><p>Để kết quả test không bị ảnh hưởng bởi đoạn delay số 1 (network) thì SSH thẳng lên server check. Lúc này cần đo lường xem request đi qua Web Server tốn bao nhiêu thời gian, request xử lý trực tiếp (không đi qua Web Server) thì tốn bao nhiêu:</p><p></p><p></p><ul><li>Check request đi qua web server:</li></ul><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-333"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_curl_on_server_default.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_curl_on_server_default-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_curl_on_server_default-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_curl_on_server_default-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><ul><li>Tốn hết 0.663s</li><li>Check request xử lý trực tiếp không thông qua web server</li></ul><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-334"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_3.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_3-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_3-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_3-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><ul><li>Tốn hết 0.602s</li></ul><p></p><p></p><p><strong><em>Kết luận:</em></strong> đi qua web server cũng không làm tăng độ trễ nhiều, vấn đề chính là ở cục PHP + MySQL thôi, tới đây loại trừ thằng Web server ra được rồi.</p><p></p><p></p><p><strong>3. Check điểm delay 3:</strong> PHP + MySQL</p><p></p><p></p><p>Không ngoài dự đoán, <strong>0.602s</strong> là thời gian xử lý của code, tính ra là gần bằng thời gian TTFB, giờ strace thử xem những system call nào đang tốn nhiều thời gian nhất:</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-335"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_4.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_4-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_4-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_4-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Hmm, <strong><em>lstat + fstat + stat</em></strong> tính ra chiếm đến hơn 50% thời gian … những system call này liên quan đến việc lấy thông tin file như permission, file size .. cơ mà, sao lại chiếm nhiều thời gian thế nhỉ? Phải chăng là do số lượng file nhiều? Hay do I/O kém?</p><p></p><p></p><p>Để hiểu rõ hơn buộc phải dump kết quả strace chi tiết ra file để nhìn rồi. </p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-336"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_5-1024x508.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_5-1024x508-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_5-1024x508-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_5-1024x508-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Lướt từ trên xuống thì thấy cái theme này nhiều file thiệt, phần lớn các system call trên liên quan đến file trong thư mục theme. Vậy giờ phải làm sao để hạn chế việc check file trên ổ cứng? Muốn bypass ổ cứng thì chỉ có phương án là đưa lên RAM … mà lại là PHP … ờ thì opcache chứ còn gì nữa. Triển luôn thôi</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-337"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_6.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_6-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_6-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_6-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Opcache đã có, giờ test lại xem nào:</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-338"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_opcode_enable_vs_disable.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_opcode_enable_vs_disable-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_opcode_enable_vs_disable-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_opcode_enable_vs_disable-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Sặc, chuyện gì vậy .. 0.832s ? Tại sao lại tốn nhiều thời gian hơn khi không dùng opcache (chỉ 0.602s)? Opcache cli đã chắc chắn được enable rồi, tại sao lại tốn nhiều thời gian hơn? Nếu chỉ là request đầu tiên (cache miss) thì còn chấp nhận được, tại sao các request tiếp theo lại vẫn chậm như vậy?</p><p></p><p></p><p>Google một hồi thì mới hiểu là ở version PHP &lt; 7.0 thì opcache chỉ có tác dụng khi process đang chạy, do đó khi mình chạy bằng command line, lúc process kết thúc cũng là lúc vùng memory lưu opcache của process đó bị hủy, giữa các lần chạy là các process khác nhau và không liên quan gì nhau nữa. Tuy nhiên, nếu vậy thì check qua web server có thể kết quả sẽ tốt hơn, vì mỗi process httpd sẽ handle được nhiều request trước khi exit.</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-339"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_curl_on_server.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_curl_on_server-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_curl_on_server-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_curl_on_server-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Có thể chứ, đúng như dự đoán, thời gian xử lý thông qua web server được giảm xuống đáng kể, chỉ còn ~0.270s. So với ban đầu (0.663s) thì cũng nhanh hơn được 3 lần, Opcache cũng được phết. Đây là còn chưa bật query cache hay memcache các kiểu lên nữa, mà để tính sau, site bé tí chưa cần thiết.</p><p></p><p></p><p>Hiện tại đang xài PHP 5.6 (do con server này build lâu rồi), sẵn tiện nghe thiên hạ đồn PHP 7 performance tốt hơn, đo lường thử phát. Hì hục nâng cấp PHP lên version 7, và kết quả:</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-340"><amp-img src="https://ddtrungit.github.io/media/posts/85/curl_on_server_php7.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/curl_on_server_php7-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/curl_on_server_php7-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/curl_on_server_php7-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Ồ, tốt hơn thật anh em ạ, so với case này thì PHP 7 nhanh gấp đôi PHP 5. Chưa kể, PHP 7 giải quyết được vụ dùng opcache ở cli nữa. strace lại phát</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-341"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_strace_opcache_cli.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_strace_opcache_cli-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_strace_opcache_cli-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_strace_opcache_cli-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Tỉ lệ thời gian dành cho các system call <strong>fstat, lstat và stat</strong> giảm xuống đáng kể, chỉ còn 21%, tuy nhiên là 21% của total 0.07s (khoảng 0,015s), so với ban đầu là 55% của 0.17s (khoảng 0.093s). Phải vậy chứ!</p><p></p><p></p><p>Tới đây thì cũng tạm hài lòng rồi, mà thôi sẵn làm luôn cho tới, đo lường cho vui. Quất thêm lớp cache nữa để bỏ qua luôn phần xử lý của cục PHP + MySQL. Đập thằng W3total Cache lên</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-342"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_w3_total_cache_enabled.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_w3_total_cache_enabled-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_w3_total_cache_enabled-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_w3_total_cache_enabled-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Lúc này check trực tiếp trên chính server, thời gian xử lý chỉ còn 0.019s. Tuy nhiên, w3total cache hoạt động dựa trên .htaccess, nghĩa là nginx vẫn còn bước proxy_pass về httpd. Tối ưu thêm chút, quất luôn nginx cache để bỏ qua đoạn proxy_pass luôn xem sao:</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-343"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_curl_on_server_nginx_cache.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_curl_on_server_nginx_cache-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_curl_on_server_nginx_cache-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_curl_on_server_nginx_cache-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>Rút ngắn chút đỉnh, còn 0.013s. Test thử từ browser xem kết quả cuối cùng so với ban đầu thế nào</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-344"><amp-img src="https://ddtrungit.github.io/media/posts/85/optimize_blog_nginx_cache-1-1024x617.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_nginx_cache-1-1024x617-xs.png 300w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_nginx_cache-1-1024x617-sm.png 480w ,https://ddtrungit.github.io/media/posts/85/responsive/optimize_blog_nginx_cache-1-1024x617-md.png 768w" alt="" layout="responsive"></amp-img></figure></figure><p></p><p></p><p>TTFB lúc này chỉ còn<strong> 36.57ms</strong>, so với ban đầu <strong>648.92s</strong>, đã nhanh hơn <strong>18 lần. </strong></p><p></p><p></p><p>Tuy nhiên, việc sử dụng nginx cache sẽ dính tới việc setup các module xóa cache và tích hợp vào wordpress, giờ lười quá nên thôi bỏ ra, nào rảnh làm tiếp!</p><p></p><aside><ul class="post-tag"><li><a href="https://ddtrungit.github.io/amp/tags/tip/index.html">Tip</a></li></ul><div class="post-share"><amp-social-share type="system" width="40" height="40" data-param-text="TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO?"></amp-social-share><amp-social-share type="facebook" width="40" height="40" data-param-app_id="" data-param-text="TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO?" data-param-href="https://ddtrungit.github.io/amp/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html"></amp-social-share><amp-social-share type="twitter" width="40" height="40" data-param-text="TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO?" data-param-url="https://ddtrungit.github.io/amp/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html"></amp-social-share><amp-social-share type="pinterest" width="40" height="40" data-param-url="https://ddtrungit.github.io/amp/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html"></amp-social-share><amp-social-share type="tumblr" width="40" height="40" data-param-text="TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO?" data-param-url="https://ddtrungit.github.io/amp/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html"></amp-social-share><amp-social-share type="whatsapp" width="40" height="40" data-param-text="TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO?" data-param-url="https://ddtrungit.github.io/amp/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html"></amp-social-share></div></aside></div></article></main><amp-animation id="showAnim" layout="nodisplay"><script type="application/json">{
                    "duration": "200ms",
                    "fill": "both",
                    "iterations": "1",
                    "direction": "alternate",
                    "animations": [{
                        "selector": ".post-scroll",
                        "keyframes": [{
                            "opacity": "1",
                            "visibility": "visible",
                            "transform": "scale(1)"
                        }]
                    }]
                }</script></amp-animation><amp-animation id="hideAnim" layout="nodisplay"><script type="application/json">{
                    "duration": "200ms",
                    "fill": "both",
                    "iterations": "1",
                    "direction": "alternate",
                    "animations": [{
                        "selector": ".post-scroll",
                        "keyframes": [{
                            "opacity": "0",
                            "visibility": "hidden",
                            "transform": "scale(0.1)"
                        }]
                    }]
                }</script></amp-animation><div class="post-scroll-marker"><amp-position-observer on="enter:hideAnim.start; exit:showAnim.start" layout="nodisplay"></amp-position-observer></div><button class="post-scroll" on="tap:top.scrollTo(duration=200)">&#8593;</button><footer class="bottom">Powered by Publii</footer><amp-sidebar id="navbar-sidebar" layout="nodisplay"><ul><li><a href="https://ddtrungit.github.io/amp/index.html">Home</a></li><li><a href="https://ddtrungit.github.io/amp/lien-he/index.html">Contact</a></li><li><a href="https://ddtrungit.github.io/amp/gioi-thieu/index.html">About</a></li><li><a href="https://ddtrungit.github.io/amp/tags/ansible/index.html">Ansible</a></li><li><a href="https://ddtrungit.github.io/amp/tags/aws/index.html">AWS</a></li><li><a href="https://ddtrungit.github.io/amp/tags/oracle/index.html">Oracle</a></li><li><a href="https://ddtrungit.github.io/amp/tags/linux/index.html">Linux</a></li><li><a href="https://ddtrungit.github.io/amp/tags/zimbra/index.html">Zimbra</a></li><li><a href="https://ddtrungit.github.io/amp/tags/tip/index.html">TIP</a></li></ul></amp-sidebar></body></html>
<!doctype html><html amp lang="vi"><head><meta charset="utf-8"><title>Linux 25 PHP Security Best Practices For Sys Admins - TRUNG DUONG</title><link rel="canonical" href="https://ddtrungit.github.io/linux-25-php-security-best-practices-for-sys-admins/"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet" type="text/css"><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script><script async custom-element="amp-video" src="https://cdn.ampproject.org/v0/amp-video-0.1.js"></script><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ddtrungit.github.io/amp/linux-25-php-security-best-practices-for-sys-admins/index.html"},"headline":"Linux 25 PHP Security Best Practices For Sys Admins","datePublished":"2021-01-22T09:15","dateModified":"2022-06-13T14:31","image":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/posts/69/1_kn9bfTW1lcX5gIItjtqw3A.png","height":350,"width":750},"description":"PHP is an open-source server-side scripting language, and it is a widely used. The Apache/Nginx/Lighttpd web server provides access to&hellip;","author":{"@type":"Person","name":"Duong Dinh Trung","url":"https://ddtrungit.github.io/amp/authors/dtrungit/"},"publisher":{"@type":"Organization","name":"Duong Dinh Trung","logo":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/website/Background_noBg.png","height":1200,"width":1600}}}</script><style amp-custom>article,
aside,
footer,
header,
hgroup,
main,
nav,
section {
  display: block; }

*,
*:before,
*:after {
  -webkit-box-sizing: content-box;
  box-sizing: content-box;
  margin: 0;
  padding: 0; }

li {
  list-style: none; }

amp-img {
  max-width: 100%; }

button,
input,
select,
textarea {
  font: inherit; }

html {
  font-size: 1rem; }

body {
  background: #f1f1f1;
  color: #262626;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  line-height: 1.6; }

a {
  color:  #039be5;
  text-decoration: none;
  -webkit-transition: all 0.12s linear 0s;
  -o-transition: all 0.12s linear 0s;
  transition: all 0.12s linear 0s; }

a:hover {
  color: #262626;
  text-decoration: underline;
  -webkit-text-decoration-skip: ink;
  text-decoration-skip: ink; }

a:active {
  color: #262626; }

a:focus {
  outline: 2px dotted #039be5; }

figure,
blockquote,
p,
ul,
ol,
dl,
table,
hr,
fieldset {
  margin-top: 1.6rem; }

h1,
h2,
h3,
h4,
h5,
h6 {
  color: #262626;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  font-weight: 500;
  line-height: 1.2;
  margin-top: 2.13333rem; }

h1 {
  font-size: 1.67583rem;
  font-weight: normal; }

h2 {
  font-size: 1.4729rem; }

h3 {
  font-size: 1.29454rem; }

h4 {
  font-size: 1.13778rem; }

h5 {
  font-size: 1rem; }

h6 {
  font-size: 0.87891rem; }

h2 + p,
h3 + p,
h4 + p,
h5 + p,
h6 + p {
  margin-top: 0.8rem; }

b,
strong {
  font-weight: 600; }

blockquote {
  color: #6c7175;
  font-family: "Droid Serif", "Times", "Source Serif Pro", serif;
  font-style: italic;
  padding: 1.33333rem 0.53333rem 1.33333rem 3.2rem;
  position: relative; }
  blockquote:before {
    display: block;
    content: "\201C";
    font-size: 4.41226rem;
    position: absolute;
    left: 0;
    top: -12px;
    color: rgba(108, 113, 117, 0.5); }
  blockquote > :nth-child(1) {
    margin-top: 0; }

ul,
ol {
  margin-left: 2rem; }
  ul > li,
  ol > li {
    list-style: inherit;
    padding: 0 0 0.26667rem 0.26667rem; }

dl dt {
  color: #262626;
  font-weight: 600; }

code,
pre {
  background-color: #f1f1f1;
  font-family: monospace; }

pre {
  margin: 1.6rem 0 0;
  padding: 1.6rem;
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow-x: auto; }
  pre > code {
    color: #262626;
    padding: 0; }

code {
  border-radius: 3px;
  color: #262626;
  padding: 0.26667rem 0.53333rem; }

table {
  border-collapse: collapse;
  border-spacing: 0;
  border: 1px solid #d4d4d4;
  width: 100%;
  overflow-x: auto;
  vertical-align: top;
  text-align: left;
  white-space: nowrap; }
  table th {
    font-weight: 500;
    padding: 0.53333rem 1.06667rem; }
  table tr {
    border-bottom: 1px solid #d4d4d4; }
    table tr:nth-child(2n) {
      background: #f1f1f1; }
  table td {
    padding: 0.53333rem 1.06667rem; }

figcaption {
  clear: both;
  color: rgba(108, 113, 117, 0.6);
  font-size: 0.82397rem;
  margin: 0.8rem 0 0;
  text-align: center; }

sub,
sup {
  font-size: 65%; }

hr {
  border: 0;
  height: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(255, 255, 255, 0.3); }

.btn, [type=button],
[type=submit],
button {
  background: #039be5;
  border: none;
  border-radius: 2px;
  color: #ffffff;
  cursor: pointer;
  display: inline-block;
  font-size: 0.87891rem;
  font-weight: 500;
  line-height: 1.9;
  padding: 0.53333rem 1.33333rem;
  text-align: center;
  text-decoration: none;
  -webkit-transition: all .15s ease;
  -o-transition: all .15s ease;
  transition: all .15s ease;
  width: auto; }
  .btn:hover, [type=button]:hover,
  [type=submit]:hover,
  button:hover {
    background: #262626;
    color: #ffffff; }
  .btn:focus, [type=button]:focus,
  [type=submit]:focus,
  button:focus {
    outline: none; }
  .btn-outline {
    border: 1px solid #ddd;
    background: #ffffff;
    border-radius: 3px;
    color: #262626; }

[type=button],
[type=submit],
button {
  text-transform: uppercase;
  -webkit-appearance: none;
  -moz-appearance: none; }

.navbar {
  background: #039be5;
  -webkit-box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.2);
  box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.2);
  line-height: 3;
  max-height: 4rem; }
  .navbar > div {
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    text-align: left;
    max-width: 700px;
    margin: 0 auto; }
  .navbar a {
    color: #ffffff;
    text-decoration: none; }
  .navbar-sidebar-toggle {
    left: 0;
    position: relative;
    text-indent: -99999rem; }
    .navbar-sidebar-toggle:before {
      content: "";
      display: block;
      border-top: 0.375rem double #ffffff;
      border-bottom: 0.125rem solid #ffffff;
      height: 0.125rem;
      position: absolute;
      text-indent: 0;
      top: 50%;
      width: 1.3rem;
      -webkit-transform: translate(0px, -50%);
      -ms-transform: translate(0px, -50%);
      transform: translate(0px, -50%); }


.logo {
            background-image: url('https://ddtrungit.github.io/media/website/Background_noBg.png');
            background-size: auto 2rem;
            background-repeat: no-repeat;
            background-position: center center;
            display: inline-block;
  font-weight: 600;
  line-height: 1;
            margin: 0 auto;
            height: 2rem;
            text-indent: -9999px;
            width: 240px;vertical-align: middle;
        }
        .logo.logo-text {
            line-height: 2;
            text-align: center;
            text-indent: 0;
        }

amp-sidebar {
  background: #ffffff;
  width: 240px; }
  amp-sidebar > ul {
    margin: 0.8rem 0 0;
    padding: 0; }
    amp-sidebar > ul ul {
      border-left: 1px solid #d4d4d4;
      margin: 0.53333rem 0 0; }
    amp-sidebar > ul li {
      color: #262626;
      font-size: 0.9375rem;
      font-weight: 600;
      list-style: none;
      line-height: 1.4;
      padding: 0.42667rem 1.06667rem; }
      amp-sidebar > ul li li {
        font-weight: normal;
        padding: 0.26667rem 0 0.26667rem 1.06667rem; }
    amp-sidebar > ul a,
    amp-sidebar > ul a:visited {
      color: #262626; }

.bg-white {
  background: #ffffff; }

.wrap-page {
  max-width: 700px;
  margin: 0 auto; }

@media all and (max-width: 43.6875em) {
  .wrap-inner {
    padding: 0 6%; } }

.page-title {
  background: #ffffff;
  -webkit-box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  margin-bottom: 0.8rem;
  padding: 1.6rem 6%; }
  .page-title > h1 {
    margin: 0;
    font-size: 1.29454rem; }
  .page-title > p {
    font-size: 0.87891rem;
    color: #6c7175;
    line-height: 1.3;
    margin: 0.26667rem 0 0; }
  .page-title-author {
    border-radius: 50%;
    float: left;
    height: 2.5rem;
    width: 2.5rem; }
    .page-title-author + h1 {
      margin-left: 3.5rem; }
      .page-title-author + h1 + p {
        margin-left: 3.5rem; }

.card {
  background: #ffffff;
  -webkit-box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  box-shadow: 0 2px 3px rgba(38, 38, 38, 0.1);
  margin-bottom: 0.8rem;
  padding-bottom: 1.06667rem; }

  .card-meta {
    border-top: 1px solid #d4d4d4;
    color: rgba(108, 113, 117, 0.6);
    font-size: 0.7242rem;
    font-weight: 500;
    margin-top: 1.06667rem;
    padding-top: 1.06667rem;
    text-transform: uppercase; }
    .card-meta a + time:before {
      content: "";
      background: #d4d4d4;
      display: inline-block;
      height: 3px;
      margin: 0 8px;
      width: 3px;
      vertical-align: middle;
      border-radius: 50%; }
  .card-text {
    font-size: 0.9375rem;
    overflow: hidden;
    padding: 0 6%; }
    .card-text h2 {
      font-size: 1.13778rem; }

.post {
  margin-bottom: 2.13333rem; }
  .post-featured-image {
    margin-top: 0;
    position: relative; }
    .post-featured-image > figcaption {
      background: rgba(0, 0, 0, 0.5);
      border-radius: 3px;
      color: #ffffff;
      position: absolute;
      bottom: 0.8rem;
      padding: 0 0.26667rem;
      right: 6%; }
  .post-header {
    margin-bottom: 2.13333rem; }
  .post-meta {
    border-bottom: 1px solid #d4d4d4;
    color: rgba(108, 113, 117, 0.6);
    font-size: 0.7242rem;
    font-weight: 500;
    margin-top: 1.06667rem;
    padding-bottom: 1.06667rem;
    text-transform: uppercase; }
    .post-meta a + time:before {
      content: "";
      background: #d4d4d4;
      display: inline-block;
      height: 3px;
      margin: 0 8px;
      width: 3px;
      vertical-align: middle;
      border-radius: 50%; }
  .post-tag {
    margin: 0; }
    .post-tag > li {
      display: inline-block;
      padding: 0; }
      .post-tag > li a {
        background: #f1f1f1;
        border-radius: 2px;
        color: #6c7175;
        font-size: 0.77248rem;
        display: inline-block;
        margin: 0 0.26667rem 0.26667rem 0;
        padding: 0.26667rem 0.53333rem; }
        .post-tag > li a:hover {
          background: #039be5;
          color: #ffffff;
          text-decoration: none; }
  .post-share {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
    -ms-flex-direction: row;
    flex-direction: row;
    -webkit-box-pack: justify;
    -ms-flex-pack: justify;
    justify-content: space-between;
    margin-top: 1.6rem;
    width: 100%; }
    .post-share amp-social-share {
      -webkit-box-flex: 1;
      -ms-flex: 1 0 auto;
      flex: 1 0 auto;
      background-size: 24px; }
  .post-scroll {
    color: #ffffff;
    background: #039be5;
    bottom: 10px;
    border-radius: 50%;
    border: none;
    -webkit-box-shadow: 0 1px 1.5px 0 rgba(38, 38, 38, 0.12), 0 1px 1px 0 rgba(38, 38, 38, 0.24);
    box-shadow: 0 1px 1.5px 0 rgba(38, 38, 38, 0.12), 0 1px 1px 0 rgba(38, 38, 38, 0.24);
    font-size: 1.13778rem;
    height: 46px;
    opacity: 0;
    outline: none;
    position: fixed;
    padding: 0;
    right: 4%;
    visibility: hidden;
    width: 46px;
    z-index: 9999; }
    .post-scroll-marker {
      height: 0px;
      position: absolute;
      top: 100px;
      width: 0px; }
        .post-pagination {
    background: #f1f1f1;
    -webkit-box-shadow: inset 0 2px 3px rgba(38, 38, 38, 0.1);
    box-shadow: inset 0 2px 3px rgba(38, 38, 38, 0.1);
    border-top: 1px solid #d4d4d4;
    padding: 1.06667rem 0; }
    .post-pagination > div {
      line-height: 1.2;
      padding: 0.53333rem 1.06667rem;
      text-align: center; }
      .post-pagination > div span {
        display: block;
        color: #6c7175;
        font-size: 0.7242rem;
        font-weight: 500;
        margin-bottom: 0.26667rem;
        text-transform: uppercase; }
    .post-pagination-prev a:before {
      content: "\2190";
      margin-right: 0.26667rem; }
    .post-pagination-next a:after {
      content: "\2192";
      margin-left: 0.26667rem; }

aside {
  margin: 1.6rem 0 0; }

.align-left {
  text-align: left; }

.align-right {
  text-align: right; }

.align-center {
  text-align: center; }

.align-justify {
  text-align: justify; }

.msg {
  border-left: 2px solid transparent;
  padding: 1.06667rem 1.06667rem; }
  .msg--highlight {
    background-color: #fff8e6;
    border-color: #e2ac4f; }
  .msg--info {
    background: rgba(45, 97, 201, 0.03);
    border-color: #039be5; }
  .msg--success {
    background: #f7fbf6;
    border-color: #5ab44b; }
  .msg--warning {
    background: #fff3f3;
    border-color: #c06367;
    color: #a94442; }

.dropcap:first-letter {
  float: left;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  font-size: 2.16943rem;
  line-height: 0.7;
  margin-right: 0.53333rem;
  padding: 0.53333rem 0.53333rem 0.53333rem 0; }

.pagination {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: justify;
  -ms-flex-pack: justify;
  justify-content: space-between;
  margin: 0.8rem 0; }
  .pagination > a {
    padding-left: 0;
    padding-right: 0;
    width: 49%; }
  .pagination-right {
    margin-left: auto; }

.bottom {
  background: #039be5;
  color: #ffffff;
  padding: 1.06667rem 4%;
  text-align: center; }</style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><script async src="https://cdn.ampproject.org/v0.js"></script><script custom-element="amp-animation" src="https://cdn.ampproject.org/v0/amp-animation-0.1.js" async></script><script custom-element="amp-position-observer" src="https://cdn.ampproject.org/v0/amp-position-observer-0.1.js" async></script></head><body class="bg-white"><nav class="navbar wrap-inner" id="top"><div><a on="tap:navbar-sidebar.toggle" class="navbar-sidebar-toggle" title="Menu">Menu</a> <a class="logo" href="https://ddtrungit.github.io/amp/index.html">TRUNG DUONG</a></div></nav><main class="wrap-page"><article class="post"><figure class="post-featured-image"><amp-img src="https://ddtrungit.github.io/media/posts/69/1_kn9bfTW1lcX5gIItjtqw3A.png" alt="" srcset="https://ddtrungit.github.io/media/posts/69/responsive/1_kn9bfTW1lcX5gIItjtqw3A-xs.png 300w ,https://ddtrungit.github.io/media/posts/69/responsive/1_kn9bfTW1lcX5gIItjtqw3A-sm.png 480w ,https://ddtrungit.github.io/media/posts/69/responsive/1_kn9bfTW1lcX5gIItjtqw3A-md.png 768w ,https://ddtrungit.github.io/media/posts/69/responsive/1_kn9bfTW1lcX5gIItjtqw3A-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" height="350" layout="responsive" width="750"></amp-img></figure><div class="wrap-inner"><header class="post-header"><h1>Linux 25 PHP Security Best Practices For Sys Admins</h1><p class="post-meta">By <a href="https://ddtrungit.github.io/amp/authors/dtrungit/index.html" rel="nofollow" title="Duong Dinh Trung">Duong Dinh Trung</a></p></header><p></p><p>PHP is an open-source server-side scripting language, and it is a widely used. The Apache/Nginx/Lighttpd web server provides access to files and content via the HTTP OR HTTPS protocol. A misconfigured server-side scripting language can create all sorts of problems. So, PHP should be used with caution. Here are twenty-five <strong>php security best practices</strong> for Linux and Unix sysadmins for configuring PHP securely.</p><p></p><p></p><figure class="wp-block-image"><amp-img alt="" layout="responsive"></amp-img></figure><p></p><p></p><figure class="wp-block-image"><amp-img src="https://ddtrungit.github.io/media/posts/69/sysadmin-logo.jpg" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/69/responsive/sysadmin-logo-xs.jpg 300w ,https://ddtrungit.github.io/media/posts/69/responsive/sysadmin-logo-sm.jpg 480w ,https://ddtrungit.github.io/media/posts/69/responsive/sysadmin-logo-md.jpg 768w" alt="" layout="responsive"></amp-img></figure><p></p><p></p><p> </p><p></p><p></p><h2>PHP security best practices</h2><p></p><p></p><p>Our sample setup for PHP security tips</p><p></p><p></p><ul><li>DocumentRoot: /var/www/html</li><li>Default Web server: Apache ( you can use Lighttpd or Nginx instead of Apache)</li><li>Default PHP configuration file: /etc/php.ini or /etc/php/7.0/fpm/php.ini</li><li>Default PHP extensions config directory: /etc/php.d/ OR /etc/php/7.0/fpm/conf.d/</li><li>Our sample php security config file: <strong>/etc/php.d/security.ini</strong> OR <strong>/etc/php/7.0/fpm/conf.d/99-security.conf</strong> (you need to create this file using a text editor)</li><li>Operating systems: RHEL / CentOS / Fedora Linux (the instructions should work with <em>any other Linux distributions</em> such as Debian / Ubuntu or other <em>Unix</em> like operating systems such as OpenBSD/FreeBSD/HP-UX).</li><li>Default PHP server TCP/UDP ports: none</li></ul><p></p><p></p><figure class="wp-block-image"><amp-img alt="" layout="responsive"></amp-img></figure><p></p><p></p><p> </p><p></p><p></p><p>Most of the actions listed in this post are written with the assumption that they will be executed by the root user running the bash or any other modern shell:<br><code>$ php -v</code><br>Sample outputs:</p><p></p><p></p><pre class="wp-block-preformatted">PHP 5.3.3 (cli) (built: Oct 24 2011 08:35:41)Copyright (c) 1997-2010 The PHP GroupZend Engine v2.3.0, Copyright (c) 1998-2010 Zend Technologies</pre><p></p><p></p><p>OR</p><p></p><p></p><pre class="wp-block-preformatted">PHP 7.3.7 (cli) (built: Jul  8 2019 09:58:12) ( NTS )Copyright (c) 1997-2018 The PHP GroupZend Engine v3.3.7, Copyright (c) 1998-2018 Zend Technologies    with Zend OPcache v7.3.7, Copyright (c) 1999-2018, by Zend Technologies</pre><p></p><p></p><p>For demonstration purpose I’m going to use the following operating system:<br><code>$ cat /etc/redhat-release</code><br>Sample outputs:</p><p></p><p></p><pre class="wp-block-preformatted">Red Hat Enterprise Linux Server release 6.1 (Santiago)</pre><p></p><p></p><p>Let us see some of php security best practices.</p><p></p><p></p><h2>1. Know Your Enemy</h2><p></p><p></p><p>PHP based apps can face the different types of attacks. I have noticed the different types of attacks:</p><p></p><p></p><ol><li><a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank" rel="noreferrer noopener">XSS</a> – Cross-site scripting is a vulnerability in php web applications, which attackers may exploit to steal users’ information. You can configure Apache and write more secure PHP scripts (validating all user input) to avoid xss attacks.</li><li><a href="https://en.wikipedia.org/wiki/SQL_injection" target="_blank" rel="noreferrer noopener">SQL injection</a> – It is a vulnerability in the database layer of an php application. When user input is incorrectly filtered any SQL statements can be executed by the application. You can configure Apache and write secure code (validating and escaping all user input) to avoid SQL injection attacks. A common practice in PHP is to escape parameters using the function called <strong>mysql_real_escape_string()</strong> before sending the SQL query.<br>Spoofing</li><li>File uploads – It allows your visitor to place files (upload files) on your server. This can result into various security problems such as delete your files, delete database, get user details and much more. You can disable file uploads using php or write secure code (like validating user input and only allow image file type such as png or gif).</li><li>Including local and remote files – An attacker can open files from remote server and execute any PHP code. This allows them to upload file, delete file and install backdoors. You can configure php to disable remote file execution.</li><li><a href="https://php.net/eval" target="_blank" rel="noreferrer noopener">eval()</a> – Evaluate a string as PHP code. This is often used by an attacker to hide their code and tools on the server itself. You can configure php to disable eval().</li><li><a href="https://yehg.net/lab/pr0js/view.php/A_Most-Neglected_Fact_About_CSRF.pdf" target="_blank" rel="noreferrer noopener">Sea-surf Attack</a> (Cross-site request forgery – CSRF) – This attack forces an end user to execute unwanted actions on a web application in which he/she is currently authenticated. A successful CSRF exploit can compromise end user data and operation in case of normal user. If the targeted end user is the administrator account, this can compromise the entire web application.</li></ol><p></p><p></p><h2>2. Find Built-in PHP Modules</h2><p></p><p></p><p>To see the set of compiled-in PHP modules type the following command:<br><code># php -m</code><br>Sample outputs:</p><p></p><p></p><pre class="wp-block-preformatted">[PHP Modules]apcbcmathbz2calendarCorectypecurldatedomeregexiffileinfofilterftpgdgettextgmphashiconvimapjsonlibxmlmbstringmemcachemysqlmysqliopensslpcntlpcrePDOpdo_mysqlpdo_sqlitePharreadlineReflectionsessionshmopSimpleXMLsocketsSPLsqlite3standardsuhosintokenizerwddxxmlxmlreaderxmlrpcxmlwriterxslzipzlib[Zend Modules]Suhosin</pre><p></p><p></p><p>I recommends that you use PHP with a reduced modules for performance and security. For example, you can disable sqlite3 module by <a href="https://www.cyberciti.biz/faq/howto-linux-unix-delete-remove-file/">deleting (removing) configuration file </a>, OR <a href="https://www.cyberciti.biz/faq/unix-mv-command-examples/">renaming (moving) a file</a> called /etc/php.d/sqlite3.ini as follows:<br><code># <a href="https://www.cyberciti.biz/faq/howto-linux-unix-delete-remove-file/">rm</a> /etc/php.d/sqlite3.ini</code><br>OR<br><code># <a href="https://www.cyberciti.biz/faq/unix-mv-command-examples/">mv</a> /etc/php.d/sqlite3.ini /etc/php.d/sqlite3.disable</code><br>Other compiled-in modules can only be removed by reinstallating PHP with a reduced configuration. You can download php source code from php.net and compile it as follows with GD, fastcgi, and MySQL support:</p><p></p><p></p><pre class="wp-block-preformatted">./configure --with-libdir=lib64 --with-gd --with-mysql --prefix=/usr --exec-prefix=/usr \--bindir=/usr/bin --sbindir=/usr/sbin --sysconfdir=/etc --datadir=/usr/share \--includedir=/usr/include --libexecdir=/usr/libexec --localstatedir=/var \--sharedstatedir=/usr/com --mandir=/usr/share/man --infodir=/usr/share/info \--cache-file=../config.cache --with-config-file-path=/etc \--with-config-file-scan-dir=/etc/php.d  --enable-fastcgi \--enable-force-cgi-redirect</pre><p></p><p></p><p>See <a href="https://www.php.net/manual/en/install.unix.php" target="_blank" rel="noreferrer noopener">how to compile and reinstall php on Unix like operating system</a> for more information.</p><p></p><p></p><h2>3. Restrict PHP Information Leakage</h2><p></p><p></p><p>To restrict PHP information leakage disable expose_php. Edit /etc/php.d/secutity.ini and set the following directive:</p><p></p><p></p><pre class="wp-block-preformatted">expose_php<strong>=</strong>Off</pre><p></p><p></p><p>When enabled, expose_php reports to the world that PHP is installed on the server, which includes the PHP version within the HTTP header (e.g., X-Powered-By: PHP/5.3.3). The PHP logo guids (see <a href="https://www.php.net/?=PHPE9568F34-D428-11d2-A769-00AA001ACF42" target="_blank" rel="noreferrer noopener">example</a>) are also exposed, thus appending them to the URL of a PHP enabled site will display the appropriate logo. When expose_php enabled you can see php version using the following command:<br><code>$ curl -I https://www.cyberciti.biz/index.php</code><br>Sample outputs:</p><p></p><p></p><pre class="wp-block-preformatted">HTTP/1.1 200 OKX-Powered-By: PHP/5.3.3Content-type: text/html; charset=UTF-8Vary: Accept-Encoding, CookieX-Vary-Options: Accept-Encoding;list-contains=gzip,Cookie;string-contains=wikiToken;string-contains=wikiLoggedOut;string-contains=wiki_sessionLast-Modified: Thu, 03 Nov 2011 22:32:55 GMT...</pre><p></p><p></p><p>I also recommend that you setup the <a href="https://www.cyberciti.biz/faq/rhel-centos-hide-httpd-version/">ServerTokens and ServerSignature directives in httpd.conf to hide Apache version</a> and <a href="https://www.cyberciti.biz/faq/hide-php-version-nginx-on-linux-unix-server/">hide PHP 5/7 version when using Nginx</a>.</p><p></p><p></p><h2>4. Minimize Loadable PHP Modules (Dynamic Extensions)</h2><p></p><p></p><p>PHP supports “Dynamic Extensions”. By default, RHEL loads all the extension modules found in /etc/php.d/ directory. To enable or disable a particular module, just find the configuration file in /etc/php.d/ directory and comment the module name. You can also rename or delete module configuration file. For best PHP performance and security, you should only enable the extensions your webapps requires. For example, to disable gd extension, type the following commands:<br><code># cd /etc/php.d/<br># mv gd.{ini,disable}<br># <a href="https://www.cyberciti.biz/faq/restart-httpd/">/sbin/service httpd restart</a></code><br>To enable php module called gd, enter:<br><code># mv gd.{disable,ini}<br># <a href="https://www.cyberciti.biz/faq/star-stop-restart-apache2-webserver/">/sbin/service httpd restart</a></code></p><p></p><p></p><h2>5. Log All PHP Errors</h2><p></p><p></p><p>Do not expose PHP error messages to all site visitors. Edit /etc/php.d/security.ini and set the following directive:</p><p></p><p></p><pre class="wp-block-preformatted">display_errors<strong>=</strong>Off</pre><p></p><p></p><p>Make sure <a href="https://www.cyberciti.biz/tips/php-howto-turn-on-error-log-file.html">you log all php errors to a log file</a>:</p><p></p><p></p><pre class="wp-block-preformatted">log_errors<strong>=</strong>Onerror_log<strong>=</strong>/var/log/httpd/php_scripts_error.log</pre><p></p><p></p><h2>6. Disallow Uploading Files</h2><p></p><p></p><p>Edit /etc/php.d/security.ini and set the following directive to disable file uploads for security reasons:</p><p></p><p></p><pre class="wp-block-preformatted">file_uploads<strong>=</strong>Off</pre><p></p><p></p><p>If users of your application need to upload files, turn this feature on by setting <a href="https://www.cyberciti.biz/faq/linux-unix-apache-increase-php-upload-limit/">upload_max_filesize limits the maximum size of files</a> that PHP will accept through uploads:</p><p></p><p></p><pre class="wp-block-preformatted">file_uploads<strong>=</strong>On# user can only upload upto 1MB via phpupload_max_filesize<strong>=</strong>1M</pre><p></p><p></p><h2>7. Turn Off Remote Code Execution</h2><p></p><p></p><p>If enabled, allow_url_fopen allows PHP’s file functions — such as file_get_contents() and the include and require statements — can retrieve data from remote locations, like an FTP or web site.</p><p></p><p></p><p>The <a href="https://www.cyberciti.biz/faq/php-resources-limits/">allow_url_fopen</a> option allows PHP’s file functions – such as file_get_contents() and the include and require statements – can retrieve data from remote locations using ftp or http protocols. Programmers frequently forget this and don’t do proper input filtering when passing user-provided data to these functions, opening them up to code <a href="http://phpsec.org/projects/phpsecinfo/tests/allow_url_fopen.html" target="_blank" rel="noreferrer noopener">injection vulnerabilities</a>. A large number of code injection vulnerabilities reported in PHP-based web applications are caused by the combination of enabling allow_url_fopen and bad input filtering. Edit /etc/php.d/security.ini and set the following directive:</p><p></p><p></p><pre class="wp-block-preformatted">allow_url_fopen<strong>=</strong>Off</pre><p></p><p></p><p>I also recommend to disable allow_url_include for security reasons:</p><p></p><p></p><pre class="wp-block-preformatted">allow_url_include<strong>=</strong>Off</pre><p></p><p></p><h2>8. Enable SQL Safe Mode</h2><p></p><p></p><p>Edit /etc/php.d/security.ini and set the following directive:</p><p></p><p></p><pre class="wp-block-preformatted">sql.safe_mode<strong>=</strong>On</pre><p></p><p></p><p>If <a href="https://www.php.net/manual/en/ini.core.php#ini.sql.safe-mode" target="_blank" rel="noreferrer noopener">turned</a> On, mysql_connect() and mysql_pconnect() ignore any arguments passed to them. Please note that you may have to make some changes to your code. Third party and open source application such as WordPress, and others may not work at all when sql.safe_mode enabled. I also recommend that you turn off <a href="https://php.net/manual/en/security.magicquotes.php" target="_blank" rel="noreferrer noopener">magic_quotes_gpc</a> for all php 5.3.x installations as the filtering by it is ineffective and not very robust. mysql_escape_string() and custom filtering functions serve a better purpose:</p><p></p><p></p><pre class="wp-block-preformatted">magic_quotes_gpc<strong>=</strong>Off</pre><p></p><p></p><h2>9. Control POST Size</h2><p></p><p></p><p>The HTTP POST request method is used when the client (browser or user) needs to send data to the Apache web server as part of the request, such as when uploading a file or submitting a completed form. Attackers may attempt to send oversized POST requests to eat your system resources. You can limit the maximum size POST request that PHP will process. Edit /etc/php.d/security.ini and set the following directive:</p><p></p><p></p><pre class="wp-block-preformatted"><em>; Set a realistic value here</em>post_max_size<strong>=</strong>1K</pre><p></p><p></p><p>The 1K sets max size of post data allowed by php apps. This setting also affects file upload. To upload large files, this value must be larger than upload_max_filesize. I also suggest that you limit available methods using Apache web server. Edit, httpd.conf and set the following directive for DocumentRoot /var/www/html:</p><p></p><p></p><pre class="wp-block-preformatted">&lt;directory /var/www/html&gt;    &lt;limitExcept GET POST&gt;        Order allow,deny    &lt;/limitExcept&gt;## Add rest of the config goes here... ##&lt;/directory&gt;</pre><p></p><p></p><h2>10. Resource Control (DoS Control)</h2><p></p><p></p><p>You can set <a href="https://www.cyberciti.biz/faq/php-resources-limits/">maximum execution time of each php script</a>, in seconds. Another recommend option is to set maximum amount of time each script may spend parsing request data, and maximum amount of memory a script may consume. Edit /etc/php.d/security.ini and set the following directives:</p><p></p><p></p><pre class="wp-block-preformatted"># set in secondsmax_execution_time <strong>=</strong>  30max_input_time <strong>=</strong> 30memory_limit <strong>=</strong> 40M</pre><p></p><p></p><h2>11. Install Suhosin Advanced Protection System for PHP</h2><p></p><p></p><p>From the <a href="https://suhosin.org/stories/index.html" target="_blank" rel="noreferrer noopener">project page</a>:</p><p></p><p></p><blockquote class="wp-block-quote"><p>Suhosin is an advanced protection system for PHP installations. It was designed to protect servers and users from known and unknown flaws in PHP applications and the PHP core. Suhosin comes in two independent parts, that can be used separately or in combination. The first part is a small patch against the PHP core, that implements a few low-level protections against bufferoverflows or format string vulnerabilities and the second part is a powerful PHP extension that implements all the other protections.</p></blockquote><p></p><p></p><p>See how to <a href="https://www.cyberciti.biz/faq/rhel-linux-install-suhosin-php-protection/">install and configure suhosin</a> under Linux operating systems.</p><p></p><p></p><h2>12. Disabling Dangerous PHP Functions</h2><p></p><p></p><p>PHP has a lot of functions which can be used to crack your server if not used properly. You can set list of functions in /etc/php.d/security.ini <a href="https://www.cyberciti.biz/faq/linux-unix-apache-lighttpd-phpini-disable-functions/">using disable_functions directive</a>:</p><p></p><p></p><pre class="wp-block-preformatted">disable_functions <strong>=</strong>exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source</pre><p></p><p></p><h2>13. PHP Fastcgi / CGI – cgi.force_redirect Directive</h2><p></p><p></p><p>PHP work with FastCGI. Fascgi reduces the memory footprint of your web server, but still gives you the speed and power of the entire PHP language. You can configure <a href="https://www.cyberciti.biz/tips/rhel-centos-fedora-apache2-fastcgi-php-configuration.html">Apache2+PHP+FastCGI</a> or <a href="https://www.cyberciti.biz/tips/rhel-centos-fedora-apache2-fastcgi-php-configuration.html">cgi as described here</a>. The configuration directive cgi.force_redirect prevents anyone from calling PHP directly with a URL like http://www.cyberciti.biz/cgi-bin/php/hackerdir/backdoor.php. Turn on cgi.force_redirect for security reasons. Edit /etc/php.d/security.ini and set the following directive:</p><p></p><p></p><pre class="wp-block-preformatted"><em>; Enable cgi.force_redirect for security reasons in a typical *Apache+PHP-CGI/FastCGI* setup</em>cgi.force_redirect<strong>=</strong>On</pre><p></p><p></p><h2>14. PHP User and Group ID</h2><p></p><p></p><p>mod_fastcgi is a cgi-module for Apache web server. It can connect to an external FASTCGI server. You need to make sure php run as non-root user. If PHP executes as a root or UID under 100, it may access and/or manipulate system files. You must execute PHP CGIs as a non-privileged user using <a href="https://wiki.archlinux.org/index.php/Apache,_suEXEC_and_Virtual_Hosts" target="_blank" rel="noreferrer noopener">Apache’s suEXEC</a> or <a href="https://www.suphp.org/DocumentationView.html?file=apache/CONFIG" target="_blank" rel="noreferrer noopener">mod_suPHP</a>. The suEXEC feature provides Apache users the ability to run CGI programs under user IDs different from the user ID of the calling web server. In this example, my php-cgi is running as phpcgi user and apache is running as apache user:<br><code># ps aux | grep php-cgi</code><br>Sample outputs:</p><p></p><p></p><pre class="wp-block-preformatted">phpcgi      6012  0.0  0.4 225036 60140 ?        S    Nov22   0:12 /usr/bin/php-cgiphpcgi      6054  0.0  0.5 229928 62820 ?        S    Nov22   0:11 /usr/bin/php-cgiphpcgi      6055  0.1  0.4 224944 53260 ?        S    Nov22   0:18 /usr/bin/php-cgiphpcgi      6085  0.0  0.4 224680 56948 ?        S    Nov22   0:11 /usr/bin/php-cgiphpcgi      6103  0.0  0.4 224564 57956 ?        S    Nov22   0:11 /usr/bin/php-cgiphpcgi      6815  0.4  0.5 228556 61220 ?        S    00:52   0:19 /usr/bin/php-cgiphpcgi      6821  0.3  0.5 228008 61252 ?        S    00:55   0:12 /usr/bin/php-cgiphpcgi      6823  0.3  0.4 225536 58536 ?        S    00:57   0:13 /usr/bin/php-cgi</pre><p></p><p></p><p>You can use <a href="https://www.cyberciti.biz/faq/freebsd-configure-nginx-php-fastcgi-server/">tool such as spawn-fcgi</a> to spawn remote and local FastCGI processes as phpcgi user (first, <a href="https://www.cyberciti.biz/faq/howto-linux-add-user-to-group/">add phpcgi user to the system</a>):<br><code># spawn-fcgi -a 127.0.0.1 -p 9000 -u phpcgi -g phpcgi -f /usr/bin/php-cgi</code><br>Now, you can configure <a href="https://www.cyberciti.biz/tips/rhel-fedora-centos-apache2-external-php-spawn.html">Apache</a>, <a href="https://www.cyberciti.biz/tips/lighttpd-mod_proxy-to-run-php-fastcgi-app-server.html">Lighttpd</a>, and <a href="https://www.cyberciti.biz/faq/rhel-fedora-install-configure-nginx-php5/">Nginx</a> web server to use external php FastCGI running on port 9000 at 127.0.0.1 IP address.</p><p></p><p></p><h2>15. Limit PHP Access To File System</h2><p></p><p></p><p>The open_basedir directive set the directories from which PHP is allowed to access files using functions like fopen(), and others. If a file is outside of the paths defined by open_basdir, PHP will refuse to open it. You cannot use a symbolic link as a workaround. For example only allow access to /var/www/html directory and not to /var/www, or /tmp or /etc directories:</p><p></p><p></p><pre class="wp-block-preformatted"><em>; Limits the PHP process from accessing files outside</em><em>; of specifically designated directories such as /var/www/html/</em>open_basedir<strong>=</strong>"/var/www/html/"<em>; ------------------------------------</em><em>; Multiple dirs example</em><em>; open_basedir="/home/httpd/vhost/cyberciti.biz/html/:/home/httpd/vhost/nixcraft.com/html/:/home/httpd/vhost/theos.in/html/"</em><em>; ------------------------------------</em></pre><p></p><p></p><h2>16. Session Path</h2><p></p><p></p><p><a href="https://www.cyberciti.biz/tips/lighttpd-beware-of-default-php-session-path-permission.html">Session support</a> in PHP consists of a way to preserve certain data across subsequent accesses. This enables you to build more customized applications and increase the appeal of your web site. This path is defined in /etc/php.ini file and all data related to a particular session will be stored in a file in the directory specified by the session.save_path option. The default is as follows under RHEL/CentOS/Fedora Linux:</p><p></p><p></p><pre class="wp-block-preformatted">session.save_path<strong>=</strong>"/var/lib/php/session"<em>; Set the temporary directory used for storing files when doing file upload</em>upload_tmp_dir<strong>=</strong>"/var/lib/php/session"</pre><p></p><p></p><p>Make sure path is <strong>outside /var/www/html</strong> and <strong>not readable or writeable</strong> by any other system users:<br><code># ls -Z /var/lib/php/</code><br>Sample outputs:</p><p></p><p></p><pre class="wp-block-preformatted">drwxrwx---. root apache system_u:object_r:httpd_var_run_t:s0 session</pre><p></p><p></p><p>Note: The -Z option to the <a href="https://www.cyberciti.biz/faq/ls-command-to-examining-the-filesystem/">ls command</a> display SELinux security context such as file mode, user, group, security context and file name.</p><p></p><p></p><h2>17. Keep PHP, Software, And OS Up to Date</h2><p></p><p></p><p>Applying security patches is an important part of maintaining Linux, Apache, PHP, and MySQL server. All php security update should be reviewed and applied as soon as possible using any one of the following tool (if you’re installing PHP via a package manager):<br><code># <a href="https://www.cyberciti.biz/faq/rhel-centos-fedora-linux-yum-command-howto/">yum update</a></code><br>OR<br><code># <a href="https://www.cyberciti.biz/tips/linux-debian-package-management-cheat-sheet.html">apt-get update &amp;&amp; apt-get upgrade</a></code><br>You can configure Red hat / CentOS / Fedora Linux to send <a href="https://www.cyberciti.biz/faq/red-hat-centos-fedora-send-package-update-notification-via-email/">yum package update notification via email</a>. Another option is to <a href="https://www.cyberciti.biz/faq/fedora-automatic-update-retrieval-installation-with-cron/">apply all security updates</a> via a <a href="https://www.cyberciti.biz/faq/how-do-i-add-jobs-to-cron-under-linux-or-unix-oses/">cron job</a>. Under Debian / Ubuntu Linux you can <a href="https://www.cyberciti.biz/faq/apt-get-apticron-send-email-upgrades-available/">use apticron to send security</a> notifications.</p><p></p><p></p><h2>18. Restrict File and Directory Access</h2><p></p><p></p><p>Make sure you run Apache as a non-root user such as Apache or www. All files and directory should be owned by non-root user (or apache user) under /var/www/html:<br><code># <a href="https://www.cyberciti.biz/faq/how-to-use-chmod-and-chown-command/">chown -R apache:apache /var/www/html/</a></code><br>/var/www/html/ is a subdirectory and DocumentRoot which is modifiable by other users since root never executes any files out of there, and shouldn’t be creating files in there.</p><p></p><p></p><p>Make sure file permissions are set to 0444 (read-only) under /var/www/html/:<br><code># chmod -R 0444 /var/www/html/</code><br>Make sure all directories permissions are set to 0445 under /var/www/html/:<br><code># <a href="https://www.cyberciti.biz/tips/linux-findinglocating-files-with-find-command-part-1.html">find /var/www/html/ -type d -print0 | xargs -0 -I {} chmod 0445 {}</a></code></p><p></p><p></p><h3>A Note About Setting Up Correct File Permissions</h3><p></p><p></p><p>The chown and chmod command make sures that under no circumstances DocumentRoot or files contained in DocumentRoot are writable by the Web server user apache. Please note that you need to set permissions that makes the most sense for the development model of your website, so feel free to adjust the chown and chmod command as per your requirements. In this example, the Apache server run as apache user. This is configured with the <em>User</em> and <em>Group</em> directives in your httpd.conf file. The apache user needs to have read access to everything under DocumentRoot but should not have write access to anything.</p><p></p><p></p><p>Make sure httpd.conf has the following directives for restrictive configuration:</p><p></p><p></p><pre class="wp-block-preformatted">&lt;directory / &gt;    Options None    AllowOverride None    Order allow,deny&lt;/directory&gt;</pre><p></p><p></p><p>You should only grant write access when required. Some web applications such as wordpress and others may need a caching directory. You can grant a write access to caching directory using the following commands:<br><code># chmod a+w /var/www/html/blog/wp-content/cache<br>### block access to all ###<br># echo 'deny from all' &gt; /var/www/html/blog/wp-content/cache/.htaccess</code></p><p></p><p></p><h2>19. Write Protect Apache, PHP, and, MySQL Configuration Files</h2><p></p><p></p><p>Use the <a href="https://www.cyberciti.biz/faq/linux-write-protecting-a-file/">chattr command</a> to write protect configuration files:<br><code># chattr +i /etc/php.ini<br># chattr +i /etc/php.d/*<br># chattr +i /etc/my.ini<br># chattr +i /etc/httpd/conf/httpd.conf<br># chattr +i /etc/</code></p><p></p><p></p><p>The chattr command can write protect your php file or files in /var/www/html directory too:<br><code># chattr +i /var/www/html/file1.php<br># chattr +i /var/www/html/</code></p><p></p><p></p><h2>20. Use Linux Security Extensions (such as SELinux)</h2><p></p><p></p><p>Linux comes with various security patches which can be used to guard against misconfigured or compromised server programs. If possible use <a href="https://www.cyberciti.biz/faq/rhel-fedora-redhat-selinux-protection/">SELinux</a> and <a href="https://www.cyberciti.biz/tips/selinux-vs-apparmor-vs-grsecurity.html">other Linux security extensions</a> to enforce limitations on network and other programs. For example, SELinux provides a variety of security policies for Linux kernel and Apache web server. To list all Apache SELinux protection variables, enter:<br><code># getsebool -a | grep httpd</code><br>Sample outputs:</p><p></p><p></p><pre class="wp-block-preformatted">allow_httpd_anon_write --&gt; offallow_httpd_mod_auth_ntlm_winbind --&gt; offallow_httpd_mod_auth_pam --&gt; offallow_httpd_sys_script_anon_write --&gt; offhttpd_builtin_scripting --&gt; onhttpd_can_check_spam --&gt; offhttpd_can_network_connect --&gt; offhttpd_can_network_connect_cobbler --&gt; offhttpd_can_network_connect_db --&gt; offhttpd_can_network_memcache --&gt; offhttpd_can_network_relay --&gt; offhttpd_can_sendmail --&gt; offhttpd_dbus_avahi --&gt; onhttpd_enable_cgi --&gt; onhttpd_enable_ftp_server --&gt; offhttpd_enable_homedirs --&gt; offhttpd_execmem --&gt; offhttpd_read_user_content --&gt; offhttpd_setrlimit --&gt; offhttpd_ssi_exec --&gt; offhttpd_tmp_exec --&gt; offhttpd_tty_comm --&gt; onhttpd_unified --&gt; onhttpd_use_cifs --&gt; offhttpd_use_gpg --&gt; offhttpd_use_nfs --&gt; off</pre><p></p><p></p><p>To disable Apache cgi support, enter:<br><code># setsebool -P httpd_enable_cgi off</code><br>See <a target="_blank" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security-Enhanced_Linux/index.html" rel="noreferrer noopener">Red Hat SELinux guide</a> for more information.</p><p></p><p></p><h2>21. Install Mod_security</h2><p></p><p></p><p>ModSecurity is an open source intrusion detection and prevention engine for web applications. You can <a href="https://www.cyberciti.biz/faq/rhel-fedora-centos-httpd-mod_security-configuration/">easily install mod_security under Linux and protect apache and php</a> based apps from xss and various other attacks:</p><p></p><p></p><pre class="wp-block-preformatted">## A few Examples ### Do not allow to open files in /etc/SecFilter /etc/ # Stop SQL injectionSecFilter "delete[[:space:]]+from"SecFilter "select.+from"</pre><p></p><p></p><h2>22. Run Apache / PHP In a Chroot Jail If Possible</h2><p></p><p></p><p>Putting PHP and/or Apache in a chroot jail minimizes the damage done by a potential break-in by isolating the web server to a small section of the filesystem. You can use traditional <a href="https://www.cyberciti.biz/tips/chroot-apache-under-rhel-fedora-centos-linux.html">chroot kind of setup with Apache</a>. However, I recommend <a href="https://www.cyberciti.biz/faq/howto-setup-freebsd-jail-with-ezjail/">FreeBSD jails</a>, <a href="https://www.cyberciti.biz/tips/rhel-centos-xen-virtualization-installation-howto.html">XEN virtulization</a>, <a href="https://www.cyberciti.biz/faq/centos-rhel-linux-kvm-virtulization-tutorial/">KVM virtulization</a>, or <a href="https://www.cyberciti.biz/faq/openvz-rhel-centos-linux-tutorial/">OpenVZ virtualization</a> which uses the concept of containers.</p><p></p><p></p><h2>23. Use Firewall To Restrict Outgoing Connections</h2><p></p><p></p><p>The attacker will download file locally on your web-server using tools such as wget. Use iptables to block outgoing connections from apache user. The ipt_owner module attempts to match various characteristics of the packet creator, for locally generated packets. It is only valid in the OUTPUT chain. In this example, allow vivek user to connect outside using port 80 (useful for RHN or centos repo access):</p><p></p><p></p><pre class="wp-block-preformatted"><strong>/</strong>sbin<strong>/</strong>iptables -A OUTPUT -o eth0 -m owner --uid-owner vivek -p tcp --dport 80 -m state --state NEW,ESTABLISHED  -j ACCEPT</pre><p></p><p></p><p>Here is another example that blocks all outgoing connections from apache user except to our own smtp server, and spam validation API service:</p><p></p><p></p><pre class="wp-block-preformatted"><em># ....</em><strong>/</strong>sbin<strong>/</strong>iptables --new-chain apache_user<strong>/</strong>sbin<strong>/</strong>iptables --append OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT<strong>/</strong>sbin<strong>/</strong>iptables --append OUTPUT -m owner --uid-owner apache -j apache_user<em># allow apache user to connec to our smtp server</em><strong>/</strong>sbin<strong>/</strong>iptables --append apache_user -p tcp --syn -d 192.168.1.100 --dport 25 -j RETURN<em># Allow apache user to connec to api server for spam validation</em><strong>/</strong>sbin<strong>/</strong>iptables --append apache_user -p tcp --syn -d  66.135.58.62 --dport 80 -j RETURN<strong>/</strong>sbin<strong>/</strong>iptables --append apache_user -p tcp --syn -d  66.135.58.61 --dport 80 -j RETURN<strong>/</strong>sbin<strong>/</strong>iptables --append apache_user -p tcp --syn -d  72.233.69.89 --dport 80 -j RETURN<strong>/</strong>sbin<strong>/</strong>iptables --append apache_user -p tcp --syn -d  72.233.69.88 --dport 80 -j RETURN<em>#########################</em><em>## Add more rules here ##</em><em>#########################</em><em># No editing below</em><em># Drop everything for apache outgoing connection</em><strong>/</strong>sbin<strong>/</strong>iptables --append apache_user -j REJECT</pre><p></p><p></p><p>See <a href="https://www.cyberciti.biz/faq/howto-configure-setup-firewall-with-ufw-on-ubuntu-linux/">how to setup a UFW firewall on Ubuntu 16.04 LTS server</a> for more info.</p><p></p><p></p><h2>24. Watch Your Logs &amp; Auditing</h2><p></p><p></p><p>Check the <a href="https://www.cyberciti.biz/faq/apache-logs/">apache log file</a>. Use the <a href="https://www.cyberciti.biz/faq/howto-use-grep-command-in-linux-unix/">grep command</a>/<a href="https://www.cyberciti.biz/faq/grep-regular-expressions/">egrep command</a>:<br><code># tail -f /var/log/httpd/error_log<br># grep 'login.php' /var/log/httpd/error_log<br># egrep -i "denied|error|warn" /var/log/httpd/error_log</code><br>Check the <a href="https://www.cyberciti.biz/faq/error_log-defines-file-where-script-errors-logged/">php log file</a>:<br><code># tail -f /var/log/httpd/php_scripts_error.log<br># grep "...etc/passwd" /var/log/httpd/php_scripts_error.log</code><br>Watching log files is a good php security practices. Log files will give you some understanding of what attacks is thrown against the server and allow you to check if the necessary level of security is present or not. The auditd service is provided for system auditing. Turn it on <a href="https://www.cyberciti.biz/tips/linux-audit-files-to-see-who-made-changes-to-a-file.html">to audit SELinux events</a>, authetication events, file modifications, account modification and so on. I also recommend using standard “<a href="https://www.cyberciti.biz/tips/top-linux-monitoring-tools.html">Linux System Monitoring Tools</a>” for monitoring your web-server.</p><p></p><p></p><h2>25. Run Service Per System or VM Instance</h2><p></p><p></p><p>For large installations it is recommended that you run, database, static, and dynamic content from different servers.</p><p></p><p></p><pre class="wp-block-preformatted">//////////////// ISP/Router ///////////////  \   |   Firewall     \      |     +------------+     | LB01       |     +------------+                 +--------------------------+                  |                 | static.lan.cyberciti.biz |		  +-----------------+--------------------------+                                    | phpcgi1.lan.cyberciti.biz|                                    +--------------------------+                                    | phpcgi2.lan.cyberciti.biz|                                    +--------------------------+                                    | mysql1.lan.cyberciti.biz |                                    +--------------------------+                                    | mcache1.lan.cyberciti.biz|                                    +--------------------------+</pre><p></p><p></p><p><small>(Fig.01: Running Services On Separate Servers)</small></p><p></p><p></p><p>Run different network services on separate servers or VM instances. This limits the number of other services that can be compromised. For example, if an attacker able to successfully exploit a software such as Apache flow, he / she will get an access to entire server including other services running on the same server (such as MySQL, e-mail server and so on). But, in the above example content are served as follows:</p><p></p><p></p><ol><li><strong>static.lan.cyberciti.biz</strong> – Use lighttpd or nginx server for static assets such as js/css/images.</li><li><strong>phpcgi1.lan.cyberciti.biz</strong> and <strong>phpcgi2.lan.cyberciti.biz</strong> – Apache web-server with php used for generating dynamic content.</li><li><strong>mysql1.lan.cyberciti.biz</strong> – MySQL database server.</li><li><strong>mcache1.lan.cyberciti.biz</strong> – Memcached server is very fast caching system for MySQL. It uses libevent or epoll (Linux runtime) to scale to any number of open connections and uses non-blocking network I/O.</li><li><strong>LB01</strong> – A nginx web and reverse proxy server in front of Apache Web servers. All connections coming from the Internet addressed to one of the Web servers are routed through the nginx proxy server, which may either deal with the request itself or pass the request wholly or partially to the main web servers. LB01 provides simple load-balancing.</li></ol><p></p><p></p><h2>26. Additional Tools</h2><p></p><p></p><p>From the <a href="https://github.com/PHPIDS/PHPIDS" target="_blank" rel="noreferrer noopener">project page</a>:</p><p></p><p></p><blockquote class="wp-block-quote"><p>PHPIDS (PHP-Intrusion Detection System) is a simple to use, well structured, fast and state-of-the-art security layer for your PHP based web application. The IDS neither strips, sanitizes nor filters any malicious input, it simply recognizes when an attacker tries to break your site and reacts in exactly the way you want it to.</p></blockquote><p></p><p></p><p>You can use PHPIDS to detect malicious users, and log any attacks detected for later review. Please note that I’ve personally not used this tool.</p><p></p><p></p><p>From the <a href="http://phpsec.org/projects/phpsecinfo/index.html" target="_blank" rel="noreferrer noopener">project page</a>:</p><p></p><p></p><blockquote class="wp-block-quote"><p>PhpSecInfo provides an equivalent to the phpinfo() function that reports security information about the PHP environment, and offers suggestions for improvement. It is not a replacement for secure development techniques, and does not do any kind of code or app auditing, but can be a useful tool in a multilayered security approach.</p></blockquote><p></p><p></p><p><amp-img src="https://ddtrungit.github.io/media/posts/69/ca1c32cc-30ef-4a89-a810-a41665d3588f" alt="" layout="responsive"></amp-img><amp-img src="https://ddtrungit.github.io/media/posts/69/Security_Information_About_PHP.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/69/responsive/Security_Information_About_PHP-xs.png 300w ,https://ddtrungit.github.io/media/posts/69/responsive/Security_Information_About_PHP-sm.png 480w ,https://ddtrungit.github.io/media/posts/69/responsive/Security_Information_About_PHP-md.png 768w" alt="Security Information About PHP Application" layout="responsive"></amp-img></p><p></p><p></p><p id="caption-attachment-8231">Fig.01: Security Information About PHP Application</p><p></p><p></p><p>See <a href="https://www.cyberciti.biz/tips/linux-security.html">Linux security hardening tips</a> which can reduce available vectors of attack on the system.</p><p></p><p></p><h2>A Note About PHP Backdoors</h2><p></p><p></p><p>You may come across php scripts or so called common backdoors such as c99, c99madshell, r57 and so on. A backdoor php script is nothing but a hidden script for bypassing all authentication and access your server on demand. It is installed by an attackers to access your server while attempting to remain undetected. Typically a PHP (or any other CGI script) script by mistake allows inclusion of code exploiting vulnerabilities in the web browser. An attacker can use such exploiting vulnerabilities to upload backdoor shells which can give him or her a number of capabilities such as:</p><p></p><p></p><ul><li>Download files</li><li>Upload files</li><li>Install rootkits</li><li>Set a spam mail servers / relay server</li><li>Set a proxy server to hide tracks</li><li>Take control of server</li><li>Take control of database server</li><li>Steal all information</li><li>Delete all information and database</li><li>Open TCP / UDP ports and much more</li></ul><p></p><p></p><h3>Tip: How Do I Search PHP Backdoors?</h3><p></p><p></p><p>Use <a href="https://www.cyberciti.biz/faq/howto-use-grep-command-in-linux-unix/">Unix / Linux grep command</a> to search c99 or r57 shell:<br><code># grep -iR 'c99' /var/www/html/<br># grep -iR 'r57' /var/www/html/<br># find /var/www/html/ -name \*.php -type f -print0 | xargs -0 grep c99<br># grep -RPn "(passthru|shell_exec|system|base64_decode|fopen|fclose|eval)" /var/www/html/</code></p><p></p><p></p><h2>Conclusion</h2><p></p><p></p><p>Your PHP based server is now properly harden and ready to show dynamic webpages. However, vulnerabilities are caused mostly by <strong>not following best practice programming rules</strong>. You should be consulted further resources for your web applications security needs especially php programming which is beyond the scope of sys admin work.</p><p></p><p></p><h3>References:</h3><p></p><p></p><ol><li><a href="https://php.net/manual/en/security.php" target="_blank" rel="noreferrer noopener">PHP security</a> – from the official php project.</li><li><a href="http://phpsec.org/projects/guide/" target="_blank" rel="noreferrer noopener">PHP security guide</a> – from the PHP security consortium project.</li><li><a href="https://httpd.apache.org/docs/current/suexec.html" target="_blank" rel="noreferrer noopener">Apache suseexec</a> – documentation from the Apache project.</li><li><a href="https://httpd.apache.org/docs/current/misc/security_tips.html" target="_blank" rel="noreferrer noopener">Apache 2.2</a> – security tips from the Apache project.</li><li><a href="https://www.owasp.org/index.php/Category:Attack" target="_blank" rel="noreferrer noopener">The Open Web Application Security Project</a> – Common types of application security attacks.</li><li><a href="https://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html">25 Nginx security tips</a></li></ol><p></p><p></p><h2>Conclusion:</h2><p></p><p></p><p>This page explained various PHP security tips that Linux sysadmin can apply. For more info see the following links:</p><p></p><p></p><ol><li><a href="http://www.amazon.com/gp/product/059600656X/ref=as_li_ss_tl?ie=UTF8&amp;tag=cyberciti-20&amp;linkCode=as2&amp;camp=217145&amp;creative=399369&amp;creativeASIN=059600656X" target="_blank" rel="noreferrer noopener">Essential PHP Security</a> (<a href="http://www.amazon.com/gp/product/B0026OR358/ref=as_li_ss_tl?ie=UTF8&amp;tag=cyberciti-20&amp;linkCode=as2&amp;camp=217145&amp;creative=399373&amp;creativeASIN=B0026OR358" target="_blank" rel="noreferrer noopener">kindle</a> edition): A book about web application security written specifically for PHP developers. It covers 30 of the most common and dangerous exploits as well as simple and effective safeguards that protect your PHP applications.</li><li><a href="http://amzn.to/2xXenyS" target="_blank" rel="noreferrer noopener">SQL Injection Attacks and Defense</a> This book covers sql injection and web-related attacks. It explains SQL injection. How to find, confirm, and automate SQL injection discovery. It has tips and tricks for finding SQL injection within the code. You can create exploits using SQL injection and design to avoid the dangers of these attacks.</li></ol><p></p><p></p><p>Got any other php security best practices? Let us know in the comments section below.</p><p></p><aside><div class="post-share"><amp-social-share type="system" width="40" height="40" data-param-text="Linux 25 PHP Security Best Practices For Sys Admins"></amp-social-share><amp-social-share type="facebook" width="40" height="40" data-param-app_id="" data-param-text="Linux 25 PHP Security Best Practices For Sys Admins" data-param-href="https://ddtrungit.github.io/amp/linux-25-php-security-best-practices-for-sys-admins/index.html"></amp-social-share><amp-social-share type="twitter" width="40" height="40" data-param-text="Linux 25 PHP Security Best Practices For Sys Admins" data-param-url="https://ddtrungit.github.io/amp/linux-25-php-security-best-practices-for-sys-admins/index.html"></amp-social-share><amp-social-share type="pinterest" width="40" height="40" data-param-url="https://ddtrungit.github.io/amp/linux-25-php-security-best-practices-for-sys-admins/index.html"></amp-social-share><amp-social-share type="tumblr" width="40" height="40" data-param-text="Linux 25 PHP Security Best Practices For Sys Admins" data-param-url="https://ddtrungit.github.io/amp/linux-25-php-security-best-practices-for-sys-admins/index.html"></amp-social-share><amp-social-share type="whatsapp" width="40" height="40" data-param-text="Linux 25 PHP Security Best Practices For Sys Admins" data-param-url="https://ddtrungit.github.io/amp/linux-25-php-security-best-practices-for-sys-admins/index.html"></amp-social-share></div></aside></div></article><nav class="post-pagination wrap-inner"><div class="post-pagination-prev"><span>Previous Post</span> <a href="https://ddtrungit.github.io/amp/20-ways-to-secure-your-apache-configuration/index.html">20 ways to Secure your Apache Configuration</a></div><div class="post-pagination-next"><span>Next Post</span> <a href="https://ddtrungit.github.io/amp/loi-khi-thay-doi-thong-so-phan-cung/index.html">Lỗi khi thay đổi thông số phần cứng</a></div></nav></main><amp-animation id="showAnim" layout="nodisplay"><script type="application/json">{
                    "duration": "200ms",
                    "fill": "both",
                    "iterations": "1",
                    "direction": "alternate",
                    "animations": [{
                        "selector": ".post-scroll",
                        "keyframes": [{
                            "opacity": "1",
                            "visibility": "visible",
                            "transform": "scale(1)"
                        }]
                    }]
                }</script></amp-animation><amp-animation id="hideAnim" layout="nodisplay"><script type="application/json">{
                    "duration": "200ms",
                    "fill": "both",
                    "iterations": "1",
                    "direction": "alternate",
                    "animations": [{
                        "selector": ".post-scroll",
                        "keyframes": [{
                            "opacity": "0",
                            "visibility": "hidden",
                            "transform": "scale(0.1)"
                        }]
                    }]
                }</script></amp-animation><div class="post-scroll-marker"><amp-position-observer on="enter:hideAnim.start; exit:showAnim.start" layout="nodisplay"></amp-position-observer></div><button class="post-scroll" on="tap:top.scrollTo(duration=200)">&#8593;</button><footer class="bottom">Powered by Publii</footer><amp-sidebar id="navbar-sidebar" layout="nodisplay"><ul><li><a href="https://ddtrungit.github.io/amp/index.html">Home</a></li><li><a href="https://ddtrungit.github.io/amp/lien-he/index.html">Contact</a></li><li><a href="https://ddtrungit.github.io/amp/gioi-thieu/index.html">About</a></li><li><a href="https://ddtrungit.github.io/amp/tags/ansible/index.html">Ansible</a></li><li><a href="https://ddtrungit.github.io/amp/tags/aws/index.html">AWS</a></li><li><a href="https://ddtrungit.github.io/amp/tags/oracle/index.html">Oracle</a></li><li><a href="https://ddtrungit.github.io/amp/tags/linux/index.html">Linux</a></li><li><a href="https://ddtrungit.github.io/amp/tags/zimbra/index.html">Zimbra</a></li><li><a href="https://ddtrungit.github.io/amp/tags/tip/index.html">TIP</a></li></ul></amp-sidebar></body></html>
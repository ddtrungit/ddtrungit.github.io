<!DOCTYPE html><html lang="vi"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Hướng dẫn debug bằng strace URL WordPress - TRUNG DUONG</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="alternate" type="application/atom+xml" href="https://ddtrungit.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://ddtrungit.github.io/feed.json"><link rel="stylesheet" href="https://ddtrungit.github.io/assets/css/style.css?v=6ddec22a33b6e591633ba53617c15038"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ddtrungit.github.io/huong-dan-debug-bang-strace-url-wordpress/index.html"},"headline":"Hướng dẫn debug bằng strace URL WordPress","datePublished":"2021-01-28T04:07","dateModified":"2022-06-13T14:29","image":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/posts/89/best-ways-to-speed-up-wp-site.jpg","height":1080,"width":1920},"description":"Sau khi chia sẻ loạt bài debug WordPress bằng cách sử dụng strace để xem chi tiết quá trình xử&hellip;","author":{"@type":"Person","name":"Duong Dinh Trung","url":"https://ddtrungit.github.io/authors/dtrungit/"},"publisher":{"@type":"Organization","name":"Duong Dinh Trung","logo":{"@type":"ImageObject","url":"https://ddtrungit.github.io/media/website/Background_2.png","height":800,"width":834}}}</script></head><body><header class="header" id="js-header"><a href="https://ddtrungit.github.io/index.html" class="logo"><img src="https://ddtrungit.github.io/media/website/Background_2.png" alt="TRUNG DUONG"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://ddtrungit.github.io/index.html" target="_self">Home</a></li><li><a href="https://ddtrungit.github.io/lien-he/index.html" target="_self">Contact</a></li><li><a href="https://ddtrungit.github.io/gioi-thieu/index.html" target="_self">About</a></li><li><a href="https://ddtrungit.github.io/tags/ansible/index.html" target="_self">Ansible</a></li><li><a href="https://ddtrungit.github.io/tags/aws/index.html" target="_self">AWS</a></li><li><a href="https://ddtrungit.github.io/tags/oracle/index.html" target="_self">Oracle</a></li><li><a href="https://ddtrungit.github.io/tags/linux/index.html" target="_self">Linux</a></li><li><a href="https://ddtrungit.github.io/tags/zimbra/index.html" target="_self">Zimbra</a></li><li><a href="https://ddtrungit.github.io/tags/tip/index.html" target="_self">TIP</a></li></ul></nav></header><main><div class="wrapper"><article class="post"><header class="post__header"><a href="https://ddtrungit.github.io/tags/tip/index.html" class="post__maintag">Tip</a><h1 class="post__title">Hướng dẫn debug bằng strace URL WordPress</h1><div class="post__meta"><div class="post__author">By <a href="https://ddtrungit.github.io/authors/dtrungit/index.html" class="invert" rel="author" title="Duong Dinh Trung">Duong Dinh Trung</a></div></div></header><figure class="post__featured-image"><img src="https://ddtrungit.github.io/media/posts/89/best-ways-to-speed-up-wp-site.jpg" srcset="https://ddtrungit.github.io/media/posts/89/responsive/best-ways-to-speed-up-wp-site-xs.jpg 300w, https://ddtrungit.github.io/media/posts/89/responsive/best-ways-to-speed-up-wp-site-sm.jpg 480w, https://ddtrungit.github.io/media/posts/89/responsive/best-ways-to-speed-up-wp-site-md.jpg 768w, https://ddtrungit.github.io/media/posts/89/responsive/best-ways-to-speed-up-wp-site-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="eager" height="1080" width="1920" alt=""></figure><div class="post__inner"><div class="post__entry"><p></p><p>Sau khi chia sẻ loạt bài debug WordPress bằng cách sử dụng strace để xem chi tiết quá trình xử lý của PHP, nhiều bạn đặt câu hỏi với mình rằng cách làm trên chỉ áp dụng được cho trang chủ (trang index), nếu trang con chậm thì phải làm thế nào? Ví dụ: làm sao để strace URL WordPress: <em>“https://blog.vietnix.vn/toi-uu-wordpress-bi-cham.html”</em> bằng command line?</p><p></p><p></p><p>Nhìn lại mô hình đơn giản của hệ thống web, ta dễ dàng nhận thấy URL <em>“/toi-uu-wordpress-bi-cham.html”</em> nằm ở bước số 1 và sẽ được tiếp nhận bởi Web Server. Còn WordPress của chúng ta là source code PHP nằm ở bước số 3. Vậy nghĩa là sẽ có 1 cơ chế để Web Server truyền URL vào WordPress. Cơ chế đó là gì, làm sao chúng ta can thiệp vào đấy đề chèn URL ta muốn bằng command line?</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-661"><img loading="lazy" src="https://ddtrungit.github.io/media/posts/89/strace_url_1.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/89/responsive/strace_url_1-xs.png 300w, https://ddtrungit.github.io/media/posts/89/responsive/strace_url_1-sm.png 480w, https://ddtrungit.github.io/media/posts/89/responsive/strace_url_1-md.png 768w" alt=""></figure></figure><p></p><p></p><h2>Server Application Progamming Interface – SAPI</h2><p></p><p></p><p>Server Application Programming Interaface (SAPI) là một module để giao tiếp trực tiếp với Web Server như Apache, Nginx, IIS. Nói cách khác, SAPI là một API được cung cấp bởi Web Server cho phép các Developers mở rộng thêm tính năng của web server.</p><p></p><p></p><p>PHP có những module để giao tiếp trực tiếp với những web server khác nhau và được gọi là SAPI. Có nhiều loại SAPIs khác nhau cho những web server extension khác nhau như: Common Gateway Interface (CGI), apache2handler, php-fpm, Command Line Interface (CLI – cái chung ta đang quan tâm)</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-662"><img loading="lazy" src="https://ddtrungit.github.io/media/posts/89/strace_url_2.jpg" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/89/responsive/strace_url_2-xs.jpg 300w, https://ddtrungit.github.io/media/posts/89/responsive/strace_url_2-sm.jpg 480w, https://ddtrungit.github.io/media/posts/89/responsive/strace_url_2-md.jpg 768w" alt=""></figure></figure><p></p><p></p><h2>Strace URL WordPress</h2><p></p><p></p><p>URL, Hostname, Request Method … là những thông tin được Web Server truyền vào cho PHP thông qua biến <a href="https://www.php.net/manual/en/reserved.variables.server.php">$_SERVER</a>. Hãy thử in ra biến này bằng command line và quan sát. Tạo file info.php với nội dung như sau trên server và chạy thử</p><p></p><p></p><pre class="wp-block-code"><code>&lt;?php print_r($_SERVER); ?&gt;</code></pre><p></p><p></p><p>Chạy file trên bằng PHP command line:</p><p></p><p></p><pre class="wp-block-code"><code>[root@blog.vietnix.vn public_html]# php info.php</code></pre><p></p><p></p><p>Kết quả</p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-663"><img loading="lazy" src="https://ddtrungit.github.io/media/posts/89/strace_url_3-1024x482.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/89/responsive/strace_url_3-1024x482-xs.png 300w, https://ddtrungit.github.io/media/posts/89/responsive/strace_url_3-1024x482-sm.png 480w, https://ddtrungit.github.io/media/posts/89/responsive/strace_url_3-1024x482-md.png 768w" alt=""></figure></figure><p></p><p></p><p>Thật thú vị, đây chẳng phải là những biến môi trường của session mình đang sử dụng hay sao? Vậy biến “$_SERVER” sẽ được set theo các biến môi trường khi chạy lệnh php. Tới đây chắc mọi người cũng biết đáp án rồi nhỉ :D? Nhiệm vụ của chúng ta là chèn thêm biến phù hợp để khai báo URL.</p><p></p><p></p><p>Và em nó, tên biến chúng ta cần set khi chạy lệnh đây: <strong>REQUEST_URI</strong></p><p></p><p></p><figure class="wp-block-image"><figure class="wp-image-664"><img loading="lazy" src="https://ddtrungit.github.io/media/posts/89/strace_url_4.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://ddtrungit.github.io/media/posts/89/responsive/strace_url_4-xs.png 300w, https://ddtrungit.github.io/media/posts/89/responsive/strace_url_4-sm.png 480w, https://ddtrungit.github.io/media/posts/89/responsive/strace_url_4-md.png 768w" alt=""></figure></figure><p></p><p></p><p>Chạy lệnh sau để set Domain + URL cho WordPress khi xử lý, kết quả trả về cho thấy đúng nội dung của URL cần strace:</p><p></p><p></p><pre class="wp-block-code"><code>[root@blog.vietnix.vn public_html]# HTTP_HOST="blog.vietnix.vn" REQUEST_URI="/toi-uu-wordpress-bi-cham.html" php index.php</code></pre><p></p><p></p><p>Tiến hành strace xử lý của PHP đối với URL <em>“https://blog.vietnix.vn/toi-uu-wordpress-bi-cham.htm”</em>:</p><p></p><p></p><pre class="wp-block-code"><code>[root@blog.vietnix.vn public_html]# HTTP_HOST="blog.vietnix.vn" REQUEST_URI="/toi-uu-wordpress-bi-cham.html" strace php index.php</code></pre><p></p><p></p><p>Bạn có thể set nhiều <a href="https://www.php.net/manual/en/reserved.variables.server.php">tham số khác cho $_SERVER</a> như Query String, request method, post payload … tùy theo tình huống hãy lựa chọn tên biến cho phù hợp. Ngoài WordPress thì cách này cũng có thể áp dụng cho các loại mã nguồn PHP khác.</p><p></p><p></p><p>Nếu khi áp dụng bị vướng mắc chỗ nào thì có thể trao đổi với mình tại <a href="https://t.me/quantrilinux">Group Telegram Quản Trị Linux</a> để cùng làm rõ nhé.</p><p></p><p></p><p>Tham khảo:</p><p></p><p></p><ul><li><a href="https://en.wikipedia.org/wiki/Server_Application_Programming_Interface">https://en.wikipedia.org/wiki/Server_Application_Programming_Interface</a></li><li><a href="https://www.php.net/manual/en/features.commandline.introduction.php">https://www.php.net/manual/en/features.commandline.introduction.php</a></li><li><a href="https://www.php.net/manual/en/reserved.variables.server.php">https://www.php.net/manual/en/reserved.variables.server.php</a></li></ul><p></p></div><footer><div class="post__tags-share"><aside class="post__share"></aside></div></footer></div></article></div><div class="post__related"><div class="wrapper"><h2 class="h5">Related posts</h2><div class="l-grid l-grid--4"><article class="c-card"><a href="https://ddtrungit.github.io/huong-dan-chong-tan-cong-ddos-bang-nginx/index.html" class="c-card__image"><img src="https://ddtrungit.github.io/media/posts/88/tai-xuong-1-1.png" srcset="https://ddtrungit.github.io/media/posts/88/responsive/tai-xuong-1-1-xs.png 300w, https://ddtrungit.github.io/media/posts/88/responsive/tai-xuong-1-1-sm.png 480w, https://ddtrungit.github.io/media/posts/88/responsive/tai-xuong-1-1-md.png 768w, https://ddtrungit.github.io/media/posts/88/responsive/tai-xuong-1-1-lg.png 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="153" width="330" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://ddtrungit.github.io/tags/linux/index.html">Linux</a></div><h3 class="c-card__title"><a href="https://ddtrungit.github.io/huong-dan-chong-tan-cong-ddos-bang-nginx/index.html" class="invert">Hướng dẫn chống tấn công DDoS bằng Nginx</a></h3></header></div></article><article class="c-card"><a href="https://ddtrungit.github.io/toi-uu-wordpress-bi-cham/index.html" class="c-card__image"><img src="https://ddtrungit.github.io/media/posts/87/best-ways-to-speed-up-wp-site.jpg" srcset="https://ddtrungit.github.io/media/posts/87/responsive/best-ways-to-speed-up-wp-site-xs.jpg 300w, https://ddtrungit.github.io/media/posts/87/responsive/best-ways-to-speed-up-wp-site-sm.jpg 480w, https://ddtrungit.github.io/media/posts/87/responsive/best-ways-to-speed-up-wp-site-md.jpg 768w, https://ddtrungit.github.io/media/posts/87/responsive/best-ways-to-speed-up-wp-site-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="1080" width="1920" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://ddtrungit.github.io/tags/tip/index.html">Tip</a></div><h3 class="c-card__title"><a href="https://ddtrungit.github.io/toi-uu-wordpress-bi-cham/index.html" class="invert">TỐI ƯU WORDPRESS BỊ CHẬM</a></h3></header></div></article><article class="c-card"><a href="https://ddtrungit.github.io/truy-tim-nguyen-nhan-loi-error-establishing-a-database-connection-cua-wordpress/index.html" class="c-card__image"><img src="https://ddtrungit.github.io/media/posts/86/best-ways-to-speed-up-wp-site.jpg" srcset="https://ddtrungit.github.io/media/posts/86/responsive/best-ways-to-speed-up-wp-site-xs.jpg 300w, https://ddtrungit.github.io/media/posts/86/responsive/best-ways-to-speed-up-wp-site-sm.jpg 480w, https://ddtrungit.github.io/media/posts/86/responsive/best-ways-to-speed-up-wp-site-md.jpg 768w, https://ddtrungit.github.io/media/posts/86/responsive/best-ways-to-speed-up-wp-site-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="1080" width="1920" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://ddtrungit.github.io/tags/tip/index.html">Tip</a></div><h3 class="c-card__title"><a href="https://ddtrungit.github.io/truy-tim-nguyen-nhan-loi-error-establishing-a-database-connection-cua-wordpress/index.html" class="invert">Truy tìm nguyên nhân lỗi “Error establishing a database connection” của WordPress</a></h3></header></div></article><article class="c-card"><a href="https://ddtrungit.github.io/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html" class="c-card__image"><img src="https://ddtrungit.github.io/media/posts/85/best-ways-to-speed-up-wp-site.jpg" srcset="https://ddtrungit.github.io/media/posts/85/responsive/best-ways-to-speed-up-wp-site-xs.jpg 300w, https://ddtrungit.github.io/media/posts/85/responsive/best-ways-to-speed-up-wp-site-sm.jpg 480w, https://ddtrungit.github.io/media/posts/85/responsive/best-ways-to-speed-up-wp-site-md.jpg 768w, https://ddtrungit.github.io/media/posts/85/responsive/best-ways-to-speed-up-wp-site-lg.jpg 1200w" sizes="(min-width: 56.25em) 100vw, (min-width: 37.5em) 50vw, 100vw" loading="lazy" height="1080" width="1920" alt=""></a><div class="c-card__wrapper"><header class="c-card__header"><div class="c-card__tag"><a href="https://ddtrungit.github.io/tags/tip/index.html">Tip</a></div><h3 class="c-card__title"><a href="https://ddtrungit.github.io/toi-da-toi-uu-wordpress-nhanh-hon-18-lan-nhu-the-nao/index.html" class="invert">TÔI ĐÃ TỐI ƯU WORDPRESS NHANH HƠN 18 LẦN NHƯ THẾ NÀO?</a></h3></header></div></article></div></div></div></main><footer class="footer"><div class="footer__social"><a href="https://facebook.com/duongtrung2103" aria-label="Facebook" class="facebook"><svg><use xlink:href="https://ddtrungit.github.io/assets/svg/svg-map.svg#facebook"/></svg></a></div><div class="footer__copyright">"DO THE THINGS YOU LOVE!"</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://ddtrungit.github.io/assets/js/scripts.min.js?v=d78591855e0ce96bf51239b499260e20"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>
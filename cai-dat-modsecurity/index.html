<!DOCTYPE html><html lang="vi"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Cài đặt Modsecurity - TRUNG DUONG</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><meta name="theme-color" content="#17181E" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#D73A42" media="(prefers-color-scheme: light)"><meta name="msapplication-navbutton-color" content="#D73A42"><meta name="apple-mobile-web-app-status-bar-style" content="#D73A42"><link rel="alternate" type="application/atom+xml" href="http://blog.dtrungit.ga/feed.xml"><link rel="alternate" type="application/json" href="http://blog.dtrungit.ga/feed.json"><link rel="shortcut icon" href="http://blog.dtrungit.ga/media/website/cropped-2019-09-16-32x32.png" type="image/x-icon"><link rel="shortcut icon" href="http://blog.dtrungit.ga/media/website/cropped-2019-09-16-32x32.png" type="image/x-icon"><link rel="stylesheet" href="http://blog.dtrungit.ga/assets/css/style.css?v=57332019283b097fa755d17b0d684374"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.dtrungit.ga/cai-dat-modsecurity/index.html"},"headline":"Cài đặt Modsecurity","datePublished":"2021-01-22T09:37","dateModified":"2022-06-13T14:32","image":{"@type":"ImageObject","url":"http://blog.dtrungit.ga/media/website/Background_2.png","height":800,"width":834},"description":"Mod_Security là một module mở rộng cho các chương trình web server như Apache, Nginx, IIS và hoạt động như&hellip;","author":{"@type":"Person","name":"Duong Dinh Trung","url":"http://blog.dtrungit.ga/authors/dtrungit/"},"publisher":{"@type":"Organization","name":"Duong Dinh Trung","logo":{"@type":"ImageObject","url":"http://blog.dtrungit.ga/media/website/Background_2.png","height":800,"width":834}}}</script></head><body><header class="header" id="js-header"><a href="http://blog.dtrungit.ga/index.html" class="logo"><img src="http://blog.dtrungit.ga/media/website/Background_2.png" alt="TRUNG DUONG"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="http://blog.dtrungit.ga/index.html" target="_self">Home</a></li><li><a href="http://blog.dtrungit.ga/lien-he/index.html" target="_self">Contact</a></li><li><a href="http://blog.dtrungit.ga/gioi-thieu/index.html" target="_self">About</a></li><li><a href="http://blog.dtrungit.ga/tags/aws/index.html" target="_self">AWS</a></li><li class="has-submenu"><a href="http://blog.dtrungit.ga/tags/linux/index.html" target="_self" aria-haspopup="true">Linux</a><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="http://blog.dtrungit.ga/tags/ansible/index.html" target="_self">Ansible</a></li><li><a href="http://blog.dtrungit.ga/tags/k8s/index.html" target="_self">Kubernetes</a></li><li><a href="http://blog.dtrungit.ga/tags/oracle/index.html" target="_self">Oracle</a></li><li><a href="http://blog.dtrungit.ga/tags/zimbra/index.html" target="_self">Zimbra</a></li><li><a href="http://blog.dtrungit.ga/tags/tip/index.html" target="_self">TIP</a></li></ul></li></ul></nav></header><main><div class="wrapper"><article class="post"><header class="post__header"><h1 class="post__title">Cài đặt Modsecurity</h1><div class="post__meta"><div class="post__author">By <a href="http://blog.dtrungit.ga/authors/dtrungit/index.html" class="invert" rel="author" title="Duong Dinh Trung">Duong Dinh Trung</a></div><div class="post__comments"><a href="http://blog.dtrungit.ga/cai-dat-modsecurity/index.html#comments" rel="nofollow" aria-label="Comments"><svg aria-hidden="true"><title>Comments</title><use xlink:href="http://blog.dtrungit.ga/assets/svg/svg-map.svg#comments"/></svg></a></div></div></header><div class="post__inner"><div class="post__entry"><p></p><p><strong><span class="has-inline-color has-vivid-green-cyan-color">Mod_Security</span></strong> là một module mở rộng cho các chương trình web server như Apache, Nginx, IIS và hoạt động như một firewall tại lớp ứng dụng web. Cùng với sự gia tăng về phương pháp tấn công web thì mod_security cũng đã cập nhật những rule và đưa ra nhiều cách phòng chống trong mã nguồn của chương trình. Một số tính chất mà mod_security có thể dùng làm Web Application Firewall:<br><strong>Tính linh động (Flexibility)</strong><br>Việc phân tích luồng HTTP theo một tiêu chí nhất định trong thực tế thường gặp vấn đề là<br>làm sao để có thể so trùng mẫu mà bạn muốn. Ngoài ra, do nhu cầu của từng hệ thống web là khác nhau dẫn đến việc phân tích trên từng loại ứng dụng cũng khác nhau. Mod_security đã kết hợp với OWASP phát triển các tập rule mẫu (Core Rule Set) nhằm tạo ra tính linh động cho từng mô hình web khác nhau, hỗ trợ người quản trị phân tích theo nhu cầu thực tế của hệ thống đang quản trị.<br><strong>Tính thụ động (Passivity)</strong><br>ModSecurity sẽ không thực thi các tác vụ nếu như người quản trị viên không chỉ định công việc cụ thể cho chương trình, việc này là khá quan trọng trong một ứng dụng có nhiệm vụ phân tích nguy cơ như ModSecurity. Mọi cảnh báo sẽ được thực hiện thông qua cơ chế phân tích và quyết định tương tác với hệ thống sẽ do người quản trị thực hiện.<br><strong>CHỨC NĂNG</strong><br>ModSecurity hoạt động với chương trình web server (ví dụ: Apache) sẽ thực hiện các tác vụ như sau:<br><em><strong>Parsing</strong></em><br>ModSecurity sẽ phân tách các dữ liệu luân chuyển qua hệ thống thành cấu trúc dữ liệu mà<br>ModSecurity định nghĩa sẵn. Cấu trúc này sẽ được chuyển qua cơ chế so trùng mẫu trong tập rule để phân tích nguy cơ.<br><strong><em>Buffering</em></strong><br>Chức năng buffer (đệm) đóng vai trò khá quan trọng trong cơ chế hoạt động của ModSec.<br>Việc này có ý nghĩa khi các request gởi đến ứng dụng web thì phải thông qua ModSecurity trước khi đến ứng dụng xử lý và những response cũng sẽ được phân tích trước khi trả về phía client. Cơ chế này là cách duy nhất để có thể ngăn chặn các cuộc tấn công thời gian thực, các dữ liệu mà ModSecurity nhận được và phân tích sẽ được lưu trữ trong RAM (bao gồm request body và response data)<br><strong><em>Logging</em></strong><br>ModSecurity hỗ trợ ghi nhật ký các gói tin HTTP: request headers, request body, response<br>header, response body nhằm hỗ trợ người quản trị phân tích nguy cơ mà hệ thống đang gặp phải để có thể ra quyết định kiểm soát.<br><em><strong>Rule Engine</strong></em><br>Các tập mẫu trong ModSecurity đóng vai trò quan trọng trong việc phát hiện các dạng tấn<br>công và thực hiện phòng chống. ModSecurity cùng phát triển với dự án OWASP phát triển các mẫu để phân tích và phòng chống các tấn công hệ thống web (Tham khảo<br>https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project)<br>Các phân nhóm mà CRS hỗ trợ:<br><code>HTTP Protection<br>Real-time Blacklist Lookups<br>Web-based Malware Detection<br>HTTP Denial of Service Protections<br>Common Web Attacks Protection<br>Automation Detection<br>Integration with AV Scanning for File Uploads<br>Tracking Sensitive Data<br>Trojan Protection<br>Identification of Application Defects<br>Error Detection and Hiding</code></p><p></p><p></p><p><span class="has-inline-color" style="color: #10a300;">Cài đặt Modsecurity:</span></p><p></p><p></p><blockquote class="wp-block-quote"><p><em>vi /etc/httpd/conf/httpd.conf</em></p></blockquote><p></p><p></p><p><em>LoadModule unique_id_module modules/mod_unique_id.so</em></p><p></p><p></p><blockquote class="wp-block-quote"><p>wget <a href="https://www.modsecurity.org/tarball/2.9.3/modsecurity-2.9.3.tar.gz">https://www.modsecurity.org/tarball/2.9.3/modsecurity-2.9.3.tar.gz</a></p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p>tar xzvf modsecurity-2.9.3.tar.gz</p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p>./configure --prefix= /etc/httpd/modules/</p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p><em>make install</em></p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p><em>cp modsecurity.conf-recommended /etc/httpd/conf.d/modsecurity.conf</em></p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p><em>cp unicode.mapping /etc/httpd/conf.d/</em></p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p><em>vi /etc/httpd/conf/httpd.conf</em></p></blockquote><p></p><p></p><p>Khi chạy <em>./configure</em><em> </em><em>--prefix=</em><em> /etc/httpd/</em><em>modules/</em> thì sẽ không cần chỉ đg dẫn như phần dưới</p><p></p><p></p><p><em>LoadModule security2_module modules/ModSecurity2.so</em></p><p></p><p></p><p><em>hoặc</em></p><p></p><p></p><p><em>LoadModule security2_module /usr/local/modsecurity/lib/mod_security2.so</em></p><p></p><p></p><blockquote class="wp-block-quote"><p>httpd -t</p></blockquote><p></p><p></p><p><span class="has-inline-color" style="color: #15a300;">Adding OWASP ModSecurity Core Rule Set (CRS)</span></p><p></p><p></p><blockquote class="wp-block-quote"><p>wget <a href="https://github.com/SpiderLabs/owasp-modsecurity-crs/archive/v3.2.0.tar.gz">https://github.com/SpiderLabs/owasp-modsecurity-crs/archive/v3.2.0.tar.gz</a></p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p>tar -zxvf v3.2.0.tar.gz</p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p>mv owasp-modsecurity-crs-3.2.0/ /etc/httpd/conf.d/crs</p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p>cd /etc/httpd/conf.d/crs</p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p>mv crs-setup.conf.example crs-setup.conf</p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p>vi /etc/httpd/conf/httpd.conf</p></blockquote><p></p><p></p><p>&lt;IfModule security2_module&gt;        </p><p></p><p></p><p>    SecDataDir /var/cache/modsecurity</p><p></p><p></p><p>   #ServerTokens Prod</p><p></p><p></p><p>    SecServerSignature "Adpia"       </p><p></p><p></p><p>    Include  conf.d/crs/crs-setup.conf</p><p></p><p></p><p>    Include conf.d/crs/rules/*.conf</p><p></p><p></p><p>&lt;/IfModule&gt;</p><p></p><p></p><blockquote class="wp-block-quote"><p>vi /etc/httpd/conf.d/modsecurity.conf</p></blockquote><p></p><p></p><p>SecRuleEngine DetectionOnly</p><p></p><p></p><p>to</p><p></p><p></p><p>SecRuleEngine On</p><p></p><p></p><blockquote class="wp-block-quote"><p>httpd -t</p></blockquote><p></p><p></p><blockquote class="wp-block-quote"><p>service httpd restart</p></blockquote><p></p></div><footer><div class="post__tags-share"><aside class="post__share"></aside></div><nav class="post__nav"><div class="post__nav__prev"><a class="post__nav__link" href="http://blog.dtrungit.ga/loi-khi-thay-doi-thong-so-phan-cung/index.html" rel="prev">Previous Post<h3 class="h6">Lỗi khi thay đổi thông số phần cứng</h3></a></div><div class="post__nav__next"><a class="post__nav__link" href="http://blog.dtrungit.ga/how-to-fix-centos-6-end-of-line-error-yumrepo-error-all-mirror-urls-are-not-using-ftp-https-or-file/index.html" rel="prev">Next Post<h3 class="h6">HOW TO FIX CENTOS 6 End of Line ERROR: YUMREPO ERROR: ALL MIRROR URLS ARE NOT USING FTP, HTTP[S] OR FILE</h3></a></div></nav></footer></div></article><div class="comments-area post__inner" id="comments"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div class="fb-comments" data-href="http://blog.dtrungit.ga/cai-dat-modsecurity/" data-width="100%" data-colorscheme="light" data-lazy="true" data-order-by="reverse_time" data-numposts="5"></div><noscript>Please enable JS to use the comments form.</noscript></div></div><div id="fb-root"></div><script type="text/javascript" async defer="defer" crossorigin="anonymous" src="https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v12.0">nonce="n4mWU9e7"</script></div></div></main><footer class="footer"><div class="footer__social"><a href="https://facebook.com/duongtrung2103" aria-label="Facebook" class="facebook"><svg><use xlink:href="http://blog.dtrungit.ga/assets/svg/svg-map.svg#facebook"/></svg></a></div><div class="footer__copyright">"DO THE THINGS YOU LOVE!"</div></footer><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="http://blog.dtrungit.ga/assets/js/scripts.min.js?v=d78591855e0ce96bf51239b499260e20"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>